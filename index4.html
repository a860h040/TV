<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STARTV — Browse</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#04050a; --bg2:#060717;
    --glass:rgba(14,16,24,.62); --glass2:rgba(12,14,22,.90);
    --text:#f3f5ff; --muted:rgba(243,245,255,.68);
    --accent:#e50914; --accent2:#ff3340;
    --border:rgba(255,255,255,.12);
    --shadow:0 18px 60px rgba(0,0,0,.45);
    --focusGlow:0 0 0 3px rgba(255,255,255,.35), 0 10px 40px rgba(229,9,20,.25);
    --r:18px; --r2:24px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(229,9,20,.18), transparent 55%),
      radial-gradient(1000px 700px at 85% 25%, rgba(125,78,255,.16), transparent 55%),
      linear-gradient(180deg, var(--bg), var(--bg2));
    overflow-x:hidden;
  }
  .topbar{
    position:sticky; top:0; z-index:50;
    display:flex; gap:14px; align-items:center;
    padding:14px 18px;
    background:linear-gradient(180deg, rgba(4,5,10,.82), rgba(4,5,10,.45));
    backdrop-filter: blur(12px);
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .logo{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.5px; font-size:18px; user-select:none; white-space:nowrap;}
  .logo .dot{width:12px; height:12px; border-radius:50%; background:linear-gradient(135deg, var(--accent), var(--accent2)); box-shadow:0 0 0 6px rgba(229,9,20,.15);}
  .spacer{flex:1}
  .searchWrap{position:relative; width:min(520px, 46vw); min-width:240px;}
  .search{
    width:100%;
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:var(--text);
    padding:12px 14px;
    border-radius:999px;
    outline:none;
    font-weight:700;
    box-shadow:0 10px 30px rgba(0,0,0,.22);
  }
  .search::placeholder{color:rgba(255,255,255,.45)}
  .search:focus{border-color:rgba(255,255,255,.28); box-shadow:0 0 0 3px rgba(255,255,255,.12), 0 18px 55px rgba(0,0,0,.35);}

  .chips{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
  .chip{
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:rgba(255,255,255,.86);
    padding:10px 12px;
    border-radius:999px;
    font-weight:900;
    font-size:12px;
    cursor:pointer;
    transition:.15s transform, .15s background, .15s border;
    outline:none;
  }
  .chip:hover{transform:translateY(-1px)}
  .chip.active{background:rgba(229,9,20,.16); border-color:rgba(229,9,20,.35); box-shadow:0 12px 30px rgba(229,9,20,.18);}
  .chip:focus-visible{box-shadow:var(--focusGlow); border-color:rgba(255,255,255,.35);}

  .hero{padding:26px 18px 10px;}
  .heroCard{
    position:relative;
    border-radius:var(--r2);
    overflow:hidden;
    border:1px solid rgba(255,255,255,.10);
    background: radial-gradient(1400px 700px at 20% 20%, rgba(229,9,20,.22), transparent 60%),
                linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    box-shadow:var(--shadow);
    min-height:320px;
  }
  .heroBg{position:absolute; inset:0; opacity:.22; background-size:cover; background-position:center; filter:saturate(1.15) contrast(1.05); transform:scale(1.03);}
  .heroOverlay{position:absolute; inset:0; background:linear-gradient(90deg, rgba(4,5,10,.92) 0%, rgba(4,5,10,.62) 48%, rgba(4,5,10,.12) 100%),
                                  linear-gradient(180deg, rgba(4,5,10,.05) 0%, rgba(4,5,10,.72) 100%);}
  .heroInner{position:relative; padding:28px 26px; display:grid; grid-template-columns:1.2fr .8fr; gap:18px; align-items:end;}
  .heroTitle{font-size:36px; line-height:1.05; font-weight:900; margin:0 0 10px;}
  .heroMeta{color:rgba(255,255,255,.74); font-weight:800; font-size:13px; margin-bottom:12px;}
  .heroDesc{color:rgba(255,255,255,.72); font-size:13px; line-height:1.5; margin:0; max-width:720px;}
  .heroBtns{display:flex; flex-wrap:wrap; gap:10px; margin-top:18px;}
  .btn{
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.06);
    color:var(--text);
    padding:12px 14px;
    border-radius:14px;
    cursor:pointer;
    font-weight:900;
    outline:none;
    user-select:none;
    display:inline-flex; align-items:center; gap:10px;
    transition:.15s transform;
  }
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{border:0; background:linear-gradient(135deg, var(--accent), var(--accent2)); box-shadow:0 18px 55px rgba(229,9,20,.22);}
  .btn:focus-visible{box-shadow:var(--focusGlow)}
  .heroPoster{justify-self:end; width:min(260px, 40vw); aspect-ratio:2/3; border-radius:18px; overflow:hidden; border:1px solid rgba(255,255,255,.12); background:#0b0e18; box-shadow:0 25px 80px rgba(0,0,0,.55);}
  .heroPoster img{width:100%; height:100%; object-fit:cover; display:block}

  .section{padding:10px 18px 26px;}
  .rowHead{display:flex; align-items:end; justify-content:space-between; gap:10px; margin:18px 0 10px;}
  .rowTitle{margin:0; font-size:16px; font-weight:900; letter-spacing:.25px;}
  .rowHint{color:rgba(255,255,255,.58); font-size:12px; font-weight:800;}

  .rail{display:flex; gap:12px; overflow:auto hidden; padding:6px 2px 10px; scroll-snap-type:x mandatory; scrollbar-width:thin; scrollbar-color:rgba(255,255,255,.18) transparent;}
  .rail::-webkit-scrollbar{height:10px}
  .rail::-webkit-scrollbar-thumb{background:rgba(255,255,255,.18); border-radius:999px}

  .card{
    scroll-snap-align:start;
    width:150px; flex:0 0 auto;
    border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04);
    box-shadow:0 18px 55px rgba(0,0,0,.28);
    cursor:pointer; outline:none;
    transition:.15s transform, .15s border, .15s box-shadow;
    position:relative;
  }
  .card:hover{transform:translateY(-2px)}
  .card:focus-visible{transform:translateY(-2px) scale(1.03); border-color:rgba(255,255,255,.35); box-shadow:var(--focusGlow);}
  .poster{aspect-ratio:2/3; background:#0b0e18;}
  .poster img{width:100%; height:100%; object-fit:cover; display:block}
  .cBody{padding:10px 10px 11px;}
  .cTitle{font-weight:900; font-size:12px; margin:0 0 5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .tag{padding:3px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); font-weight:900; font-size:10px; color:rgba(255,255,255,.78); display:inline-block; margin-right:6px;}
  .badge{
    position:absolute; top:10px; left:10px;
    padding:6px 9px; border-radius:999px;
    background:rgba(0,0,0,.45);
    border:1px solid rgba(255,255,255,.14);
    font-size:10px; font-weight:900;
    color:rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
  }

  /* Episodes modal */
  .modal{
    position:fixed; inset:0; z-index:100;
    display:none;
    background:rgba(0,0,0,.72);
    backdrop-filter: blur(10px);
    align-items:center; justify-content:center;
    padding:18px;
  }
  .modal.show{display:flex}
  .sheet{
    width:min(980px, 96vw);
    max-height:min(86vh, 860px);
    overflow:hidden;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(12,14,22,.92);
    box-shadow:var(--shadow);
    display:grid;
    grid-template-columns: 320px 1fr;
  }
  .sheetLeft{padding:16px; border-right:1px solid rgba(255,255,255,.08); display:grid; grid-template-rows:auto auto 1fr auto; gap:10px;}
  .sheetPoster{width:100%; aspect-ratio:2/3; border-radius:16px; overflow:hidden; border:1px solid rgba(255,255,255,.12); background:#0b0e18;}
  .sheetPoster img{width:100%; height:100%; object-fit:cover; display:block}
  .sheetTitle{margin:0; font-weight:900; font-size:18px; line-height:1.15}
  .sheetDesc{margin:0; color:rgba(255,255,255,.72); font-size:12px; line-height:1.45}
  .sheetActions{display:flex; gap:10px; flex-wrap:wrap}
  .sheetRight{padding:16px; overflow:auto}
  .epGrid{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px, 1fr)); gap:10px;}
  .ep{
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04);
    border-radius:16px;
    padding:12px;
    cursor:pointer;
    outline:none;
    transition:.15s transform, .15s border, .15s box-shadow;
  }
  .ep:hover{transform:translateY(-1px)}
  .ep:focus-visible{border-color:rgba(255,255,255,.35); box-shadow:var(--focusGlow);}
  .epT{margin:0 0 6px; font-weight:900; font-size:12px}
  .epS{margin:0; color:rgba(255,255,255,.66); font-size:11px}

  /* Toast */
  .toast{position:fixed; left:14px; right:14px; bottom:14px; z-index:120; display:none;}
  .toast.show{display:block}
  .toastInner{max-width:980px; margin:0 auto; padding:12px 14px; border-radius:16px; border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.55); backdrop-filter: blur(10px); color:rgba(255,255,255,.86); font-size:13px; box-shadow:0 18px 60px rgba(0,0,0,.35);}

  @media (max-width: 820px){
    .heroInner{grid-template-columns:1fr; align-items:start}
    .heroPoster{justify-self:start; width:180px}
    .sheet{grid-template-columns:1fr}
    .sheetLeft{border-right:0; border-bottom:1px solid rgba(255,255,255,.08)}
  }
</style>
</head>

<body>

<header class="topbar">
  <div class="logo" tabindex="0"><span class="dot"></span><span>STARTV</span></div>

  <div class="chips" id="chips"></div>

  <div class="spacer"></div>

  <div class="searchWrap">
    <input id="search" class="search" type="text" placeholder="Search movies & series…" autocomplete="off" />
  </div>
</header>

<section class="hero">
  <div class="heroCard">
    <div class="heroBg" id="heroBg"></div>
    <div class="heroOverlay"></div>
    <div class="heroInner">
      <div>
        <h1 class="heroTitle" id="heroTitle">Loading…</h1>
        <div class="heroMeta" id="heroMeta"></div>
        <p class="heroDesc" id="heroDesc"></p>
        <div class="heroBtns">
          <button class="btn primary" id="heroPlay" type="button">▶ Play</button>
          <button class="btn" id="heroDetails" type="button">ℹ Details</button>
        </div>
      </div>
      <div class="heroPoster"><img id="heroPoster" alt="poster"></div>
    </div>
  </div>
</section>

<main class="section" id="rows"></main>

<!-- Episodes Modal (for series) -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <div class="sheetLeft">
      <div class="sheetPoster"><img id="mPoster" alt="poster"></div>
      <h2 class="sheetTitle" id="mTitle"></h2>
      <p class="sheetDesc" id="mDesc"></p>
      <div class="sheetActions">
        <button class="btn primary" id="mPlay" type="button">▶ Play</button>
        <button class="btn" id="mClose" type="button">✕ Close</button>
      </div>
      <div style="color:rgba(255,255,255,.55); font-size:12px; font-weight:800;">
        Remote: ↑↓←→ move • Enter select • Back/Esc close
      </div>
    </div>
    <div class="sheetRight">
      <h3 style="margin:0 0 10px; font-weight:900; font-size:14px;">Episodes</h3>
      <div class="epGrid" id="mEpisodes"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"><div class="toastInner" id="toastInner"></div></div>

<script>
/* =========================
   IMPORTANT:
   This is your GitHub “sheet” link.
   If sheet.json is in the SAME repo root, keep it: "./sheet.json"
   Or use a full URL (GitHub Pages URL or raw GitHub URL).
   ========================= */
const SHEET_URL_DEFAULT = "./sheet.json";

/* Allow overriding the sheet url from query string:
   index.html?sheet=https://.../sheet.json
*/
const sheetUrl = new URLSearchParams(location.search).get("sheet") || SHEET_URL_DEFAULT;

const CHIP_LIST = ["All", "Movies", "Series"];
const state = { filter: "All", items: [], hero: null, q: "" };

const $ = s => document.querySelector(s);

function toast(msg){
  const t = $("#toast");
  $("#toastInner").innerHTML = msg;
  t.classList.add("show");
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>t.classList.remove("show"), 2200);
}

function normalize(s){ return (s||"").toLowerCase().trim(); }

async function loadSheet(){
  // Cache-bust optional: add ?v=timestamp to avoid TV cache
  const url = sheetUrl + (sheetUrl.includes("?") ? "&" : "?") + "v=" + Date.now();
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error("Sheet fetch failed: " + res.status);
  const data = await res.json();
  if (!data || !Array.isArray(data.items)) throw new Error("Bad sheet format (need {items:[]}).");
  return data.items;
}

function passesFilter(item){
  if (state.filter === "All") return true;
  if (state.filter === "Movies") return item.type === "movie";
  if (state.filter === "Series") return item.type === "series";
  return true;
}

function passesSearch(item){
  if (!state.q) return true;
  return normalize(item.title).includes(state.q);
}

/* Navigate to Page 2:
   send only the sheet link + the selected id (and episode index for series)
*/
function goPlayer(itemId, epIndex=null){
  const qs = new URLSearchParams({
    sheet: sheetUrl,
    id: itemId
  });
  if (epIndex !== null) qs.set("ep", String(epIndex));
  location.href = "player.html?" + qs.toString();
}

function buildChips(){
  const wrap = $("#chips");
  wrap.innerHTML = "";
  CHIP_LIST.forEach(name=>{
    const b = document.createElement("button");
    b.className = "chip" + (name === state.filter ? " active" : "");
    b.textContent = name;
    b.type = "button";
    b.addEventListener("click", ()=>{
      state.filter = name;
      buildChips();
      renderRows();
      toast(`Filter: <b>${name}</b>`);
    });
    wrap.appendChild(b);
  });
}

function renderHero(){
  const hero = state.items.find(x=>x.hero) || state.items[0];
  state.hero = hero;

  $("#heroTitle").textContent = hero ? hero.title : "STARTV";
  $("#heroMeta").textContent = hero ? [
    hero.year || "",
    hero.type === "series" ? "Series" : "Movie",
    hero.quality || ""
  ].filter(Boolean).join(" • ") : "";

  $("#heroDesc").textContent = hero?.description || "";
  $("#heroPoster").src = hero?.poster || "";
  $("#heroBg").style.backgroundImage = hero?.poster ? `url('${hero.poster}')` : "none";

  $("#heroPlay").onclick = ()=>{
    if (!hero) return;
    if (hero.type === "series"){
      // Play first episode (or chosen later in modal)
      if (hero.episodes && hero.episodes.length) goPlayer(hero.id, 0);
      else toast("No episodes found.");
    } else {
      goPlayer(hero.id);
    }
  };

  $("#heroDetails").onclick = ()=>{
    if (!hero) return;
    if (hero.type === "series") openSeriesModal(hero);
    else toast("This is a movie. Press Play.");
  };
}

function groupRows(items){
  const movies = items.filter(x=>x.type==="movie");
  const series = items.filter(x=>x.type==="series");
  const rows = [];
  rows.push({ title:"Featured", hint:"Pick something to watch", items: items.slice(0, 20) });
  if (movies.length) rows.push({ title:"Movies", hint:"Movies list", items: movies.slice(0, 40) });
  if (series.length) rows.push({ title:"Series", hint:"Choose a show → episode", items: series.slice(0, 40) });
  return rows;
}

function renderRows(){
  const mount = $("#rows");
  const filtered = state.items
    .filter(passesFilter)
    .filter(passesSearch);

  const rows = groupRows(filtered);
  mount.innerHTML = "";

  rows.forEach((row, rowIndex)=>{
    const sec = document.createElement("section");

    const head = document.createElement("div");
    head.className = "rowHead";
    head.innerHTML = `<h2 class="rowTitle">${row.title}</h2><div class="rowHint">${row.hint}</div>`;
    sec.appendChild(head);

    const rail = document.createElement("div");
    rail.className = "rail";
    rail.dataset.row = String(rowIndex);

    row.items.forEach((it, colIndex)=>{
      const btn = document.createElement("button");
      btn.className = "card";
      btn.type = "button";
      btn.tabIndex = 0;
      btn.dataset.row = String(rowIndex);
      btn.dataset.col = String(colIndex);

      btn.innerHTML = `
        <div class="badge">${it.type === "series" ? "Series" : "Movie"}</div>
        <div class="poster"><img alt="" src="${it.poster || ""}"></div>
        <div class="cBody">
          <p class="cTitle">${it.title || "Untitled"}</p>
          <div>
            <span class="tag">${it.year || "—"}</span>
            <span class="tag">${it.quality || "HD"}</span>
          </div>
        </div>
      `;

      btn.addEventListener("click", ()=>{
        if (it.type === "series") openSeriesModal(it);
        else goPlayer(it.id);
      });

      rail.appendChild(btn);
    });

    sec.appendChild(rail);
    mount.appendChild(sec);
  });
}

/* Series Modal */
let modalItem = null;

function openSeriesModal(item){
  modalItem = item;
  $("#modal").classList.add("show");
  $("#modal").setAttribute("aria-hidden","false");
  $("#mPoster").src = item.poster || "";
  $("#mTitle").textContent = item.title || "";
  $("#mDesc").textContent = item.description || "";

  const eps = $("#mEpisodes");
  eps.innerHTML = "";

  const list = Array.isArray(item.episodes) ? item.episodes : [];
  if (!list.length){
    const div = document.createElement("div");
    div.style.color = "rgba(255,255,255,.7)";
    div.style.fontWeight = "800";
    div.textContent = "No episodes found in sheet.";
    eps.appendChild(div);
  } else {
    list.forEach((ep, i)=>{
      const b = document.createElement("button");
      b.className = "ep";
      b.type = "button";
      b.tabIndex = 0;
      b.innerHTML = `
        <p class="epT">${ep.title || ("Episode " + (i+1))}</p>
        <p class="epS">${ep.note || ""}</p>
      `;
      b.addEventListener("click", ()=> goPlayer(item.id, i));
      eps.appendChild(b);
    });
  }

  $("#mPlay").onclick = ()=> goPlayer(item.id, 0);
  $("#mClose").onclick = closeModal;

  setTimeout(()=> $("#mPlay").focus(), 0);
}

function closeModal(){
  $("#modal").classList.remove("show");
  $("#modal").setAttribute("aria-hidden","true");
  modalItem = null;
}

$("#modal").addEventListener("click", (e)=>{ if (e.target === $("#modal")) closeModal(); });

/* Remote keys */
document.addEventListener("keydown", (e)=>{
  const code = e.keyCode || e.which;
  const isBack =
    e.key === "Escape" || e.key === "Backspace" ||
    code === 27 || code === 8 || code === 461 || code === 10009;

  if ($("#modal").classList.contains("show") && isBack){
    e.preventDefault();
    closeModal();
    return;
  }
  if ($("#modal").classList.contains("show") && (e.key === "Enter" || code === 13)){
    const a = document.activeElement;
    if (a && typeof a.click === "function"){ e.preventDefault(); a.click(); }
  }
}, {passive:false});

/* Search */
$("#search").addEventListener("input", (e)=>{
  state.q = normalize(e.target.value);
  renderRows();
});

/* Boot */
(async function boot(){
  try{
    buildChips();
    state.items = await loadSheet();
    renderHero();
    renderRows();
    toast("Loaded from GitHub sheet ✅");
  }catch(err){
    console.error(err);
    $("#heroTitle").textContent = "Cannot load sheet";
    $("#heroDesc").textContent = "Check sheet URL and JSON format.";
    toast("Sheet error ❌");
  }
})();
</script>
</body>
</html>
