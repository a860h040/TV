<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STARTV â€” Movies + Series (Open/Copy Popup)</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

<style>
  :root{
    /* Base */
    --bg:#04050a;
    --bg2:#060717;
    --glass:rgba(14,16,24,.62);
    --glass2:rgba(12,14,22,.88);
    --text:#f3f5ff;
    --muted:rgba(243,245,255,.68);

    /* Netflix-ish Accent */
    --accent:#e50914;
    --accent2:#ff3340;
    --glow:rgba(229,9,20,.35);

    /* UI */
    --border:rgba(255,255,255,.12);
    --card:rgba(255,255,255,.06);
    --card2:rgba(255,255,255,.08);
    --shadow:0 14px 60px rgba(0,0,0,.55);
    --radius:18px;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: radial-gradient(1100px 700px at 20% -10%, rgba(229,9,20,.18), transparent 55%),
                radial-gradient(900px 600px at 85% 10%, rgba(255,51,64,.12), transparent 55%),
                linear-gradient(180deg, var(--bg), var(--bg2));
    color:var(--text);
    min-height:100vh;
  }

  /* Top Bar */
  .topbar{
    position:sticky; top:0; z-index:1000;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px;
    padding:14px 18px;
    background:rgba(4,5,10,.75);
    backdrop-filter: blur(14px);
    border-bottom:1px solid var(--border);
  }
  .brand{
    display:flex; align-items:center; gap:10px;
    font-weight:900; letter-spacing:.6px;
  }
  .brand .dot{
    width:10px;height:10px;border-radius:50%;
    background:var(--accent);
    box-shadow:0 0 24px var(--glow);
  }
  .brand span{ font-size:18px; }

  .tabs{
    display:flex; gap:10px; align-items:center;
    background:rgba(255,255,255,.05);
    border:1px solid var(--border);
    border-radius:999px;
    padding:6px;
  }
  .tab{
    border:0; cursor:pointer;
    background:transparent;
    color:var(--muted);
    font-weight:800;
    padding:10px 14px;
    border-radius:999px;
    outline:none;
  }
  .tab.active{
    color:var(--text);
    background:linear-gradient(135deg, rgba(229,9,20,.95), rgba(255,51,64,.75));
    box-shadow:0 10px 30px rgba(229,9,20,.18);
  }

  .right{
    display:flex; align-items:center; gap:10px;
    min-width: 260px;
    justify-content:flex-end;
  }

  .searchWrap{
    position:relative;
    width:min(420px, 44vw);
  }
  .search{
    width:100%;
    padding:12px 14px 12px 42px;
    border-radius:999px;
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:var(--text);
    outline:none;
    font-weight:600;
  }
  .search::placeholder{ color:rgba(243,245,255,.45); }
  .searchIcon{
    position:absolute; left:14px; top:50%;
    transform:translateY(-50%);
    opacity:.75;
    user-select:none;
  }

  /* Hero */
  .hero{
    padding:22px 18px 10px;
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap:16px;
    max-width:1200px;
    margin:0 auto;
  }
  .heroCard{
    border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px;
    overflow:hidden;
    position:relative;
  }
  .heroCard::before{
    content:"";
    position:absolute; inset:-2px;
    background: radial-gradient(500px 250px at 20% 0%, rgba(229,9,20,.25), transparent 60%),
                radial-gradient(450px 220px at 90% 30%, rgba(255,51,64,.15), transparent 60%);
    pointer-events:none;
  }
  .heroInner{ position:relative; z-index:1; }
  .heroTitle{
    font-size:28px;
    font-weight:900;
    margin:0 0 8px;
    line-height:1.12;
  }
  .heroSub{
    color:var(--muted);
    font-weight:600;
    margin:0 0 14px;
  }
  .pillRow{ display:flex; gap:10px; flex-wrap:wrap; }
  .pill{
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    padding:8px 12px;
    border-radius:999px;
    font-weight:800;
    color:rgba(243,245,255,.86);
  }
  .heroSide{
    display:grid;
    gap:16px;
  }
  .mini{
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    border-radius:var(--radius);
    padding:16px;
    box-shadow:var(--shadow);
  }
  .mini h3{ margin:0 0 6px; font-size:14px; letter-spacing:.4px; }
  .mini p{ margin:0; color:var(--muted); font-weight:600; font-size:12.5px; line-height:1.35; }

  /* Content */
  .content{
    max-width:1200px;
    margin:0 auto;
    padding:10px 18px 40px;
  }

  .sectionTitle{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    margin:14px 0 10px;
  }
  .sectionTitle h2{
    margin:0;
    font-size:16px;
    font-weight:900;
    letter-spacing:.35px;
  }
  .sectionTitle .count{
    color:var(--muted);
    font-weight:700;
    font-size:12.5px;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    gap:12px;
  }
  @media (max-width:1100px){ .grid{ grid-template-columns: repeat(5, 1fr);} }
  @media (max-width:900px){ .grid{ grid-template-columns: repeat(4, 1fr);} .hero{ grid-template-columns:1fr; } .right{ min-width:auto; } }
  @media (max-width:650px){ .grid{ grid-template-columns: repeat(3, 1fr);} .searchWrap{ width:52vw; } }
  @media (max-width:480px){ .grid{ grid-template-columns: repeat(2, 1fr);} .searchWrap{ width:60vw; } }

  .card{
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    border-radius:16px;
    overflow:hidden;
    cursor:pointer;
    transition: transform .15s ease, background .15s ease;
    outline:none;
  }
  .card:hover{ transform: translateY(-3px); background:rgba(255,255,255,.07); }
  .poster{
    aspect-ratio: 2 / 3;
    background:linear-gradient(135deg, rgba(229,9,20,.22), rgba(255,255,255,.05));
    display:flex; align-items:center; justify-content:center;
    color:rgba(243,245,255,.8);
    font-weight:900;
    letter-spacing:.5px;
    position:relative;
  }
  .poster img{ width:100%; height:100%; object-fit:cover; display:block; }
  .meta{
    padding:10px 10px 12px;
  }
  .title{
    font-weight:900;
    font-size:12.5px;
    line-height:1.25;
    margin:0 0 4px;
  }
  .sub{
    margin:0;
    color:var(--muted);
    font-size:11.5px;
    font-weight:700;
  }

  /* Series details modal */
  .modalOverlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,.65);
    backdrop-filter: blur(10px);
    display:none;
    align-items:center; justify-content:center;
    z-index:99998;
    padding:16px;
  }
  .modal{
    width:min(980px, 96vw);
    max-height: min(84vh, 760px);
    overflow:hidden;
    border-radius:22px;
    border:1px solid var(--border);
    background:rgba(12,14,22,.92);
    box-shadow:0 18px 70px rgba(0,0,0,.65);
    display:grid;
    grid-template-columns: 280px 1fr;
  }
  @media (max-width:860px){
    .modal{ grid-template-columns: 1fr; }
    .modalLeft{ display:none; }
  }
  .modalLeft{
    border-right:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    padding:16px;
  }
  .modalLeft .bigPoster{
    width:100%;
    aspect-ratio: 2/3;
    border-radius:16px;
    overflow:hidden;
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    display:flex; align-items:center; justify-content:center;
    font-weight:900;
    color:rgba(243,245,255,.85);
  }
  .modalLeft .bigPoster img{ width:100%; height:100%; object-fit:cover; display:block; }
  .modalLeft h3{ margin:12px 0 6px; font-size:15px; font-weight:900; }
  .modalLeft p{ margin:0; color:var(--muted); font-weight:600; font-size:12px; line-height:1.4; }
  .modalRight{
    padding:16px 16px 10px;
    display:flex;
    flex-direction:column;
    min-height: 0;
  }
  .modalHeader{
    display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    margin-bottom:10px;
  }
  .modalHeader .hTitle{
    font-weight:900; font-size:18px; margin:0;
  }
  .closeX{
    width:38px; height:38px;
    border-radius:12px;
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:var(--text);
    cursor:pointer;
    font-weight:900;
  }

  .seasonsRow{
    display:flex; gap:10px; flex-wrap:wrap;
    margin:8px 0 12px;
  }
  .seasonBtn{
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:rgba(243,245,255,.88);
    padding:10px 12px;
    border-radius:999px;
    font-weight:900;
    cursor:pointer;
    outline:none;
  }
  .seasonBtn.active{
    background:linear-gradient(135deg, rgba(229,9,20,.92), rgba(255,51,64,.72));
    border-color:rgba(229,9,20,.35);
  }

  .episodes{
    overflow:auto;
    padding-right:6px;
    margin-top:4px;
    border-top:1px solid rgba(255,255,255,.08);
  }
  .ep{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:12px 10px;
    border-bottom:1px solid rgba(255,255,255,.06);
    cursor:pointer;
    outline:none;
  }
  .ep:hover{ background:rgba(255,255,255,.05); }
  .ep .epTitle{
    margin:0;
    font-weight:900;
    font-size:13px;
  }
  .ep .epMeta{
    margin:0;
    color:var(--muted);
    font-weight:700;
    font-size:11.5px;
  }
  .ep .chev{ opacity:.8; font-weight:900; }

  /* Open/Copy Popup (shared for Episodes + Movies) */
  .lp-overlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,.65);
    backdrop-filter: blur(10px);
    display:none;
    align-items:center; justify-content:center;
    z-index:99999;
    padding:16px;
  }
  .lp-modal{
    width:min(420px, 92vw);
    background:rgba(14,16,24,.92);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    padding:18px 16px 14px;
    position:relative;
    box-shadow:0 18px 60px rgba(0,0,0,.6);
  }
  .lp-title{
    color:#f3f5ff;
    font-weight:900;
    font-size:16px;
    margin-bottom:12px;
  }
  .lp-actions{
    display:flex; gap:10px;
  }
  .lp-btn{
    flex:1;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    color:#f3f5ff;
    padding:12px 12px;
    border-radius:12px;
    font-weight:900;
    cursor:pointer;
  }
  .lp-btn:hover{ background:rgba(255,255,255,.10); }
  .lp-open{
    background:linear-gradient(135deg, rgba(229,9,20,.95), rgba(255,51,64,.85));
    border-color:rgba(229,9,20,.35);
  }
  .lp-open:hover{ filter:brightness(1.05); }
  .lp-close{
    position:absolute; top:10px; right:10px;
    width:34px; height:34px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:#f3f5ff;
    cursor:pointer;
    font-weight:900;
  }

  /* Toast */
  .toast{
    position:fixed;
    left:50%;
    bottom:18px;
    transform:translateX(-50%);
    background:rgba(14,16,24,.92);
    border:1px solid rgba(255,255,255,.12);
    color:#f3f5ff;
    padding:10px 12px;
    border-radius:999px;
    font-weight:800;
    display:none;
    z-index:999999;
    box-shadow:0 14px 50px rgba(0,0,0,.55);
  }
</style>
</head>

<body>

<!-- Top Bar -->
<div class="topbar">
  <div class="brand" tabindex="0">
    <div class="dot"></div>
    <span>STARTV</span>
  </div>

  <div class="tabs" role="tablist" aria-label="Sections">
    <button class="tab active" id="tabSeries" role="tab" aria-selected="true">Series</button>
    <button class="tab" id="tabMovies" role="tab" aria-selected="false">Movies</button>
  </div>

  <div class="right">
    <div class="searchWrap">
      <div class="searchIcon">ðŸ”Ž</div>
      <input id="search" class="search" placeholder="Search movies or series..." autocomplete="off" />
    </div>
  </div>
</div>

<!-- Hero -->
<div class="hero">
  <div class="heroCard">
    <div class="heroInner">
      <h1 class="heroTitle">Choose Series or Movies â€” click an item and get Open / Copy</h1>
      <p class="heroSub">Episodes already show the popup. Now Movies do the exact same thing.</p>
      <div class="pillRow">
        <div class="pill">Open</div>
        <div class="pill">Copy</div>
        <div class="pill">Keyboard/Remote friendly</div>
      </div>
    </div>
  </div>

  <div class="heroSide">
    <div class="mini">
      <h3>How it works</h3>
      <p>Click a movie card â†’ popup appears â†’ Open or Copy. Click a series â†’ pick season â†’ click episode â†’ same popup.</p>
    </div>
    <div class="mini">
      <h3>Where to plug your real links</h3>
      <p>Replace the sample <b>movies</b> and <b>series</b> arrays in the script with your real data/API.</p>
    </div>
  </div>
</div>

<!-- Content -->
<div class="content">

  <div id="seriesSection">
    <div class="sectionTitle">
      <h2>Series</h2>
      <div class="count" id="seriesCount"></div>
    </div>
    <div class="grid" id="seriesGrid"></div>
  </div>

  <div id="moviesSection" style="display:none;">
    <div class="sectionTitle">
      <h2>Movies</h2>
      <div class="count" id="moviesCount"></div>
    </div>
    <div class="grid" id="moviesGrid"></div>
  </div>

</div>

<!-- Series Details Modal -->
<div class="modalOverlay" id="seriesModalOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="seriesModalTitle">
    <div class="modalLeft">
      <div class="bigPoster" id="seriesBigPoster">SERIES</div>
      <h3 id="seriesLeftTitle">Series</h3>
      <p id="seriesLeftDesc">Pick a season then click an episode. Popup will show Open / Copy.</p>
    </div>
    <div class="modalRight">
      <div class="modalHeader">
        <h2 class="hTitle" id="seriesModalTitle">Series</h2>
        <button class="closeX" id="closeSeriesModal" aria-label="Close series modal">âœ•</button>
      </div>

      <div class="seasonsRow" id="seasonsRow"></div>
      <div class="episodes" id="episodesList"></div>
    </div>
  </div>
</div>

<!-- Open/Copy Popup (shared for Episodes + Movies) -->
<div id="linkPopupOverlay" class="lp-overlay" aria-hidden="true">
  <div class="lp-modal" role="dialog" aria-modal="true" aria-labelledby="lpTitle">
    <div class="lp-title" id="lpTitle">Choose an action</div>
    <div class="lp-actions">
      <button id="lpOpenBtn" class="lp-btn lp-open">Open</button>
      <button id="lpCopyBtn" class="lp-btn lp-copy">Copy</button>
    </div>
    <button id="lpCloseBtn" class="lp-close" aria-label="Close">âœ•</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================
   SAMPLE DATA (replace with your API)
   ========================= */
const DATA = {
  movies: [
    {
      title: "Movie One",
      year: "2025",
      poster: "", // put image url or leave blank
      url: "https://example.com/movie-one.m3u8"
    },
    {
      title: "Movie Two",
      year: "2024",
      poster: "",
      url: "https://example.com/movie-two.mp4"
    },
    {
      title: "Movie Three",
      year: "2023",
      poster: "",
      url: "https://example.com/movie-three.mkv"
    }
  ],
  series: [
    {
      title: "Series Alpha",
      seasons: [
        {
          name: "Season 1",
          episodes: [
            { title: "Episode 1", url: "https://example.com/alpha-s1-e1.m3u8" },
            { title: "Episode 2", url: "https://example.com/alpha-s1-e2.m3u8" },
            { title: "Episode 3", url: "https://example.com/alpha-s1-e3.m3u8" }
          ]
        },
        {
          name: "Season 2",
          episodes: [
            { title: "Episode 1", url: "https://example.com/alpha-s2-e1.m3u8" },
            { title: "Episode 2", url: "https://example.com/alpha-s2-e2.m3u8" }
          ]
        }
      ]
    },
    {
      title: "Series Beta",
      seasons: [
        {
          name: "Season 1",
          episodes: [
            { title: "Episode 1", url: "https://example.com/beta-s1-e1.mp4" },
            { title: "Episode 2", url: "https://example.com/beta-s1-e2.mp4" }
          ]
        }
      ]
    }
  ]
};

/* =========================
   STATE
   ========================= */
let currentTab = "series";
let currentSeries = null;
let currentSeasonIndex = 0;

/* =========================
   ELEMENTS
   ========================= */
const tabSeries = document.getElementById("tabSeries");
const tabMovies = document.getElementById("tabMovies");

const seriesSection = document.getElementById("seriesSection");
const moviesSection = document.getElementById("moviesSection");

const seriesGrid = document.getElementById("seriesGrid");
const moviesGrid = document.getElementById("moviesGrid");

const seriesCount = document.getElementById("seriesCount");
const moviesCount = document.getElementById("moviesCount");

const searchInput = document.getElementById("search");

/* Series Modal */
const seriesModalOverlay = document.getElementById("seriesModalOverlay");
const closeSeriesModal = document.getElementById("closeSeriesModal");
const seriesModalTitle = document.getElementById("seriesModalTitle");
const seriesBigPoster = document.getElementById("seriesBigPoster");
const seriesLeftTitle = document.getElementById("seriesLeftTitle");
const seasonsRow = document.getElementById("seasonsRow");
const episodesList = document.getElementById("episodesList");

/* Open/Copy Popup */
const linkPopupOverlay = document.getElementById("linkPopupOverlay");
const lpOpenBtn = document.getElementById("lpOpenBtn");
const lpCopyBtn = document.getElementById("lpCopyBtn");
const lpCloseBtn = document.getElementById("lpCloseBtn");
let __lpCurrentUrl = "";

/* Toast */
const toast = document.getElementById("toast");

/* =========================
   HELPERS
   ========================= */
function showToast(msg){
  toast.textContent = msg;
  toast.style.display = "block";
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> toast.style.display="none", 1400);
}

function safeText(s){
  return (s ?? "").toString();
}

/* =========================
   OPEN/COPY POPUP (shared)
   ========================= */
function showOpenCopyPopup(url){
  if (!url) return;
  __lpCurrentUrl = url;
  linkPopupOverlay.style.display = "flex";
  linkPopupOverlay.setAttribute("aria-hidden","false");
  setTimeout(() => lpOpenBtn.focus(), 0);
}
function hideOpenCopyPopup(){
  linkPopupOverlay.style.display = "none";
  linkPopupOverlay.setAttribute("aria-hidden","true");
  __lpCurrentUrl = "";
}
async function copyToClipboard(text){
  try{
    await navigator.clipboard.writeText(text);
    return true;
  }catch(e){
    // fallback
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position = "fixed";
    ta.style.opacity = "0";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    const ok = document.execCommand("copy");
    document.body.removeChild(ta);
    return ok;
  }
}

/* Popup button actions */
lpOpenBtn.addEventListener("click", () => {
  if (!__lpCurrentUrl) return;
  window.open(__lpCurrentUrl, "_blank", "noopener,noreferrer");
  hideOpenCopyPopup();
});
lpCopyBtn.addEventListener("click", async () => {
  if (!__lpCurrentUrl) return;
  const ok = await copyToClipboard(__lpCurrentUrl);
  showToast(ok ? "Copied!" : "Copy failed");
  hideOpenCopyPopup();
});
lpCloseBtn.addEventListener("click", hideOpenCopyPopup);
linkPopupOverlay.addEventListener("click", (e) => {
  if (e.target === linkPopupOverlay) hideOpenCopyPopup();
});

/* ESC closes things */
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape"){
    if (linkPopupOverlay.style.display === "flex") hideOpenCopyPopup();
    if (seriesModalOverlay.style.display === "flex") hideSeriesModal();
  }
});

/* =========================
   TABS
   ========================= */
function setTab(tab){
  currentTab = tab;

  const seriesOn = tab === "series";
  tabSeries.classList.toggle("active", seriesOn);
  tabMovies.classList.toggle("active", !seriesOn);
  tabSeries.setAttribute("aria-selected", seriesOn ? "true" : "false");
  tabMovies.setAttribute("aria-selected", !seriesOn ? "true" : "false");

  seriesSection.style.display = seriesOn ? "" : "none";
  moviesSection.style.display = seriesOn ? "none" : "";

  searchInput.value = "";
  render();
}
tabSeries.addEventListener("click", () => setTab("series"));
tabMovies.addEventListener("click", () => setTab("movies"));

/* =========================
   RENDER
   ========================= */
function render(){
  const q = safeText(searchInput.value).trim().toLowerCase();

  if (currentTab === "series"){
    const filtered = DATA.series.filter(s => s.title.toLowerCase().includes(q));
    seriesCount.textContent = `${filtered.length} items`;
    seriesGrid.innerHTML = filtered.map((s, idx) => seriesCardHTML(s, idx)).join("");
    // bind
    [...seriesGrid.querySelectorAll(".card")].forEach(card => {
      card.addEventListener("click", () => {
        const i = parseInt(card.getAttribute("data-i"), 10);
        openSeriesModal(filtered[i]);
      });
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter") card.click();
      });
    });
  } else {
    const filtered = DATA.movies.filter(m => m.title.toLowerCase().includes(q));
    moviesCount.textContent = `${filtered.length} items`;
    moviesGrid.innerHTML = filtered.map((m, idx) => movieCardHTML(m, idx)).join("");
    // bind
    [...moviesGrid.querySelectorAll(".card")].forEach(card => {
      card.addEventListener("click", () => {
        const i = parseInt(card.getAttribute("data-i"), 10);
        const movie = filtered[i];

        /* âœ… THIS IS THE MAIN CHANGE:
           Movies now do EXACT same thing as episodes:
           show popup with Open / Copy */
        showOpenCopyPopup(movie.url);
      });
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter") card.click();
      });
    });
  }
}

function seriesCardHTML(s, i){
  return `
    <div class="card" tabindex="0" data-i="${i}">
      <div class="poster">
        ${s.poster ? `<img src="${s.poster}" alt="">` : `<div style="padding:14px;text-align:center">SERIES</div>`}
      </div>
      <div class="meta">
        <p class="title">${safeText(s.title)}</p>
        <p class="sub">${(s.seasons?.length ?? 0)} season(s)</p>
      </div>
    </div>
  `;
}

function movieCardHTML(m, i){
  return `
    <div class="card" tabindex="0" data-i="${i}">
      <div class="poster">
        ${m.poster ? `<img src="${m.poster}" alt="">` : `<div style="padding:14px;text-align:center">MOVIE</div>`}
      </div>
      <div class="meta">
        <p class="title">${safeText(m.title)}</p>
        <p class="sub">${safeText(m.year)}</p>
      </div>
    </div>
  `;
}

/* =========================
   SERIES MODAL (Episodes -> Popup Open/Copy)
   ========================= */
function openSeriesModal(series){
  currentSeries = series;
  currentSeasonIndex = 0;

  seriesModalTitle.textContent = series.title;
  seriesLeftTitle.textContent = series.title;

  if (series.poster){
    seriesBigPoster.innerHTML = `<img src="${series.poster}" alt="">`;
  } else {
    seriesBigPoster.textContent = "SERIES";
  }

  seriesModalOverlay.style.display = "flex";
  seriesModalOverlay.setAttribute("aria-hidden","false");

  renderSeasons();
  renderEpisodes();
}

function hideSeriesModal(){
  seriesModalOverlay.style.display = "none";
  seriesModalOverlay.setAttribute("aria-hidden","true");
  currentSeries = null;
  seasonsRow.innerHTML = "";
  episodesList.innerHTML = "";
}

closeSeriesModal.addEventListener("click", hideSeriesModal);
seriesModalOverlay.addEventListener("click", (e) => {
  if (e.target === seriesModalOverlay) hideSeriesModal();
});

function renderSeasons(){
  const seasons = currentSeries?.seasons ?? [];
  seasonsRow.innerHTML = seasons.map((s, idx) => {
    const active = idx === currentSeasonIndex ? "active" : "";
    return `<button class="seasonBtn ${active}" data-s="${idx}">${safeText(s.name)}</button>`;
  }).join("");

  [...seasonsRow.querySelectorAll(".seasonBtn")].forEach(btn => {
    btn.addEventListener("click", () => {
      currentSeasonIndex = parseInt(btn.getAttribute("data-s"), 10);
      renderSeasons();
      renderEpisodes();
    });
  });
}

function renderEpisodes(){
  const season = currentSeries?.seasons?.[currentSeasonIndex];
  const eps = season?.episodes ?? [];
  episodesList.innerHTML = eps.map((ep, i) => {
    return `
      <div class="ep" tabindex="0" data-e="${i}">
        <div>
          <p class="epTitle">${safeText(ep.title)}</p>
          <p class="epMeta">${safeText(season.name)}</p>
        </div>
        <div class="chev">â€º</div>
      </div>
    `;
  }).join("");

  [...episodesList.querySelectorAll(".ep")].forEach(row => {
    row.addEventListener("click", () => {
      const i = parseInt(row.getAttribute("data-e"), 10);
      const ep = eps[i];

      /* âœ… Episodes already show popup Open/Copy */
      showOpenCopyPopup(ep.url);
    });
    row.addEventListener("keydown", (e) => {
      if (e.key === "Enter") row.click();
    });
  });
}

/* =========================
   SEARCH
   ========================= */
searchInput.addEventListener("input", () => render());

/* Init */
render();
</script>

</body>
</html>
