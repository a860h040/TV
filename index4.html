<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STARTV ‚Äî Stream UI (Hero + Rows)</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

<style>
  :root{
    /* Base */
    --bg:#04050a;
    --bg2:#060717;
    --glass:rgba(14,16,24,.62);
    --glass2:rgba(12,14,22,.88);
    --text:#f3f5ff;
    --muted:rgba(243,245,255,.68);

    /* Netflix-ish Accent */
    --accent:#e50914;
    --accent2:#ff3340;
    --glow:rgba(229,9,20,.35);

    /* UI */
    --border:rgba(255,255,255,.10);
    --border2:rgba(255,255,255,.14);
    --shadow:0 20px 80px rgba(0,0,0,.62);
    --shadow2:0 14px 34px rgba(0,0,0,.38);
    --radius:26px;
    --radiusSm:18px;

    /* Layout */
    --railW:96px;

    /* Cards */
    --cardW:172px;
    --cardH:252px;

    /* Motion */
    --ease: cubic-bezier(.2,.9,.2,1);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Poppins, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 900px at 70% -10%, rgba(229,9,20,.20), transparent 55%),
      radial-gradient(900px 650px at 12% 20%, rgba(109,40,217,.15), transparent 60%),
      radial-gradient(1000px 800px at 80% 90%, rgba(59,130,246,.10), transparent 60%),
      linear-gradient(180deg, var(--bg) 0%, var(--bg2) 55%, var(--bg) 100%);
    overflow-x:hidden;
  }

  /* ===== Ambient animated glow layer ===== */
  body::before{
    content:"";
    position:fixed; inset:-30%;
    background:
      radial-gradient(900px 700px at 25% 20%, rgba(229,9,20,.14), transparent 60%),
      radial-gradient(850px 650px at 70% 55%, rgba(59,130,246,.12), transparent 62%),
      radial-gradient(900px 700px at 45% 95%, rgba(34,197,94,.10), transparent 60%);
    filter: blur(28px);
    opacity:.9;
    animation: floatGlow 12s var(--ease) infinite alternate;
    z-index:-2;
    pointer-events:none;
  }
  @keyframes floatGlow{
    from{ transform: translate3d(-1.4%, -1.8%, 0) scale(1.02); }
    to  { transform: translate3d( 1.6%,  1.1%, 0) scale(1.06); }
  }

  /* ===== Film grain ===== */
  body::after{
    content:"";
    position:fixed; inset:0;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
    opacity:.06;
    mix-blend-mode:overlay;
    z-index:-1;
    pointer-events:none;
  }

  .hide{display:none!important}
  input,button{font-family:inherit}
  ::selection{ background: rgba(229,9,20,.35); }

  /* ===== TV focus ring (remote control) ===== */
  .tv-focus{
    outline: 3px solid rgba(229,9,20,.92);
    outline-offset: 4px;
    box-shadow: 0 0 0 8px rgba(229,9,20,.14), 0 22px 60px rgba(0,0,0,.35);
    border-radius: 18px;
  }

  /* =========================================================
     LOGIN PAGE
     ========================================================= */
  body:not(.loggedIn) header,
  body:not(.loggedIn) #browsePage,
  body:not(.loggedIn) #seeAllPage,
  body:not(.loggedIn) #drawer,
  body:not(.loggedIn) #playerModal{
    display:none;
  }

  #loginPage{
    position:fixed;
    inset:0;
    z-index:500;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  body.loggedIn #loginPage{ display:none; }

  .loginCard{
    width:min(560px, 92vw);
    border-radius: 34px;
    background:
      radial-gradient(900px 420px at 12% 0%, rgba(229,9,20,.14), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.14);
    box-shadow: var(--shadow);
    backdrop-filter: blur(18px);
    padding: 26px 22px 20px;
    position:relative;
    overflow:hidden;
    text-align:center;
  }
  .loginCard::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(520px 260px at 18% 18%, rgba(255,255,255,.14), transparent 62%);
    opacity:.55;
    pointer-events:none;
  }
  .loginCard::after{
    content:"";
    position:absolute; inset:0;
    border-radius:34px;
    padding:1px;
    background: linear-gradient(135deg, rgba(255,255,255,.18), rgba(229,9,20,.22), rgba(255,255,255,.10));
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    pointer-events:none;
    opacity:.75;
  }
  .loginTop{
    position:relative;
    z-index:2;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    margin-bottom: 12px;
    user-select:none;
  }
  .loginSub{
    position:relative;
    z-index:2;
    margin: 0 0 14px 0;
    color: rgba(243,245,255,.80);
    font-size: .95rem;
    line-height: 1.5;
  }
  .loginCred{
    position:relative;
    z-index:2;
    width:min(420px, 92vw);
    margin: 0 auto 14px;
    display:grid;
    gap:10px;
  }
  .loginBtn{
    position:relative;
    z-index:2;
    width:min(420px, 92vw);
    margin: 0 auto;
    height:56px;
    border-radius: 22px;
  }
  #loginStatus{
    position:relative;
    z-index:2;
    width:min(420px, 92vw);
    margin: 14px auto 0;
    text-align:center;
    font-size:.72rem;
    color:var(--muted);
  }
  .loginHint{
    position:relative;
    z-index:2;
    margin-top:10px;
    color: rgba(243,245,255,.55);
    font-size: .80rem;
  }

  /* =========================================================
     LEFT RAIL
     ========================================================= */
  header{
    position:fixed;
    top:0; left:0;
    width:var(--railW);
    height:100vh;
    z-index:100;
    background:
      radial-gradient(800px 500px at 20% 0%, rgba(229,9,20,.10), transparent 55%),
      linear-gradient(180deg, rgba(10,11,16,.96), rgba(10,11,16,.86));
    border-right:1px solid rgba(255,255,255,.08);
    backdrop-filter: blur(16px);
  }
  header.solid{
    background:
      radial-gradient(800px 500px at 20% 0%, rgba(229,9,20,.12), transparent 55%),
      linear-gradient(180deg, rgba(10,11,16,.98), rgba(10,11,16,.92));
    border-right:1px solid rgba(255,255,255,.10);
  }

  .rail{
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    padding:16px 12px;
  }

  .brand{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    margin-bottom:2px;
    user-select:none;
  }
  .brandMark{
    width:46px; height:46px;
    border-radius:16px;
    background:
      radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.22), transparent 60%),
      linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 14px 34px rgba(229,9,20,.28), 0 0 0 9px rgba(229,9,20,.10);
    position:relative;
    overflow:hidden;
  }
  .brandMark::after{
    content:"";
    position:absolute; inset:-45%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.38), transparent);
    transform: rotate(20deg) translateX(-55%);
    animation: shine 2.35s var(--ease) infinite;
    opacity:.55;
  }
  @keyframes shine{
    0%{ transform: rotate(20deg) translateX(-65%); }
    55%{ transform: rotate(20deg) translateX(65%); }
    100%{ transform: rotate(20deg) translateX(65%); }
  }
  .brandText{
    font-weight:900;
    letter-spacing:.75px;
    font-size:.95rem;
    opacity:.95;
  }

  .pill{
    display:flex;
    align-items:center;
    gap:10px;
    width:100%;
    padding:10px 10px;
    border-radius:18px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.11);
    box-shadow: 0 10px 24px rgba(0,0,0,.18);
    transition: border-color .18s var(--ease), box-shadow .18s var(--ease), background .18s var(--ease);
  }
  .pill:focus-within{
    border-color: rgba(229,9,20,.42);
    background: rgba(255,255,255,.07);
    box-shadow: 0 0 0 7px rgba(229,9,20,.12), 0 10px 30px rgba(0,0,0,.24);
  }
  input{
    width:100%;
    border:0;
    outline:none;
    background:transparent;
    color:var(--text);
    font-size:.86rem;
    letter-spacing:.2px;
  }
  input::placeholder{color:rgba(243,245,255,.45)}

  .railBtn{
    width:100%;
    height:50px;
    border-radius:20px;
    border:1px solid rgba(255,255,255,.11);
    background: rgba(255,255,255,.05);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    cursor:pointer;
    transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease), filter .18s var(--ease), box-shadow .18s var(--ease);
    position:relative;
    overflow:hidden;
    user-select:none;
  }
  .railBtn:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,.08);
    border-color: rgba(255,255,255,.18);
    box-shadow: 0 14px 28px rgba(0,0,0,.22);
  }
  .railBtn:active{ transform: translateY(0px) scale(.99); }
  .railBtn:disabled{ opacity:.42; cursor:not-allowed; box-shadow:none; }

  .railBtn.primary{
    border:0;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 18px 40px rgba(229,9,20,.22);
  }
  .railBtn.primary:hover{ filter: brightness(1.06); }

  .ic{ width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; opacity:.92; }
  .lbl{ display:none; }

  .navActive{
    background: rgba(229,9,20,.16) !important;
    border-color: rgba(229,9,20,.50) !important;
    box-shadow: 0 0 0 7px rgba(229,9,20,.12), 0 16px 34px rgba(0,0,0,.25);
  }
  .navActive::before{
    content:"";
    position:absolute;
    left:6px;
    top:10px;
    bottom:10px;
    width:3px;
    border-radius:999px;
    background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.18));
  }

  .spacer{ flex:1; }

  #status{
    width:100%;
    text-align:center;
    font-size:.72rem;
    color:var(--muted);
  }
  .statusPill{
    display:inline-block;
    width:100%;
    padding:10px 10px;
    border-radius:18px;
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.10);
  }
  .ok{ color:#22c55e; }
  .err{ color:#ef4444; }
  .warn{ color:#fbbf24; }

  /* =========================================================
     SEARCH OVERLAY
     ========================================================= */
  #searchWrap{
    position:fixed;
    left: calc(var(--railW) + 18px);
    top: 18px;
    width: min(1120px, calc(100vw - var(--railW) - 36px));
    max-height: 0;
    overflow:hidden;
    transform: translateY(-12px) scale(.995);
    opacity:0;
    transition: max-height .28s var(--ease), transform .28s var(--ease), opacity .18s var(--ease);
    z-index:120;
    pointer-events:none;
  }
  #searchWrap.open{
    max-height: min(72vh, 680px);
    transform: translateY(0) scale(1);
    opacity:1;
    pointer-events:auto;
  }
  .searchShell{
    border-radius: 30px;
    background:
      radial-gradient(900px 260px at 18% 0%, rgba(229,9,20,.14), transparent 60%),
      rgba(0,0,0,.58);
    border:1px solid rgba(255,255,255,.16);
    box-shadow: var(--shadow);
    backdrop-filter: blur(18px);
    overflow:hidden;
    position:relative;
  }
  .searchShell::before{
    content:"";
    position:absolute; inset:0;
    border-radius: 30px;
    padding:1px;
    background: linear-gradient(135deg, rgba(255,255,255,.18), rgba(229,9,20,.22), rgba(255,255,255,.10));
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    pointer-events:none;
    opacity:.75;
  }
  .searchBar{
    padding:14px 14px;
    display:flex;
    align-items:center;
    gap:12px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    background:
      radial-gradient(520px 220px at 12% 0%, rgba(229,9,20,.12), transparent 60%),
      rgba(255,255,255,.03);
  }
  .searchIcon{
    width:46px; height:46px;
    border-radius:18px;
    display:flex; align-items:center; justify-content:center;
    background: rgba(255,255,255,.07);
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 10px 24px rgba(0,0,0,.18);
  }
  .searchBar input{ font-size:1.08rem; letter-spacing:.15px; }
  .kbd{
    font-size:.78rem;
    color:rgba(243,245,255,.78);
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px;
    padding:7px 11px;
    user-select:none;
  }
  #searchResults{
    display:none;
    max-height: calc(min(72vh, 680px) - 82px);
    overflow:auto;
    padding: 2px 0;
  }
  #searchResults.show{ display:block; }
  #searchResults::-webkit-scrollbar{ width:11px }
  #searchResults::-webkit-scrollbar-thumb{
    background: rgba(255,255,255,.16);
    border-radius:999px;
    border: 2px solid rgba(0,0,0,.35);
  }
  #searchResults::-webkit-scrollbar-track{ background: transparent; }

  .resItem{
    display:flex;
    align-items:center;
    gap:14px;
    padding:12px 14px;
    border-top:1px solid rgba(255,255,255,.06);
    cursor:pointer;
    transition: background .16s var(--ease), transform .16s var(--ease);
  }
  .resItem:hover{ background: rgba(255,255,255,.06); transform: translateX(2px); }
  .resThumb{
    width:54px; height:80px;
    border-radius:18px;
    object-fit:cover;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 12px 28px rgba(0,0,0,.24);
    flex:0 0 auto;
  }
  .resText{ min-width:0; }
  .resName{
    font-weight:900;
    font-size:1.04rem;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .resMeta{
    margin-top:4px;
    color:var(--muted);
    font-size:.88rem;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  /* =========================================================
     MAIN OFFSET
     ========================================================= */
  #browsePage, #seeAllPage{ margin-left: var(--railW); }

  /* =========================================================
     HERO
     ========================================================= */
  .hero{
    position:relative;
    min-height:74vh;
    display:flex;
    align-items:flex-end;
    overflow:hidden;
  }
  .heroBg{
    position:absolute;
    inset:-2%;
    background:
      linear-gradient(90deg, rgba(4,5,10,.98) 0%, rgba(4,5,10,.66) 46%, rgba(4,5,10,.20) 76%, rgba(4,5,10,.98) 100%),
      linear-gradient(0deg, rgba(4,5,10,.98) 0%, rgba(4,5,10,.58) 28%, rgba(4,5,10,.14) 60%, rgba(4,5,10,.98) 100%),
      url('https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?auto=format&fit=crop&w=1800&q=60');
    background-size:cover;
    background-position:center;
    filter:saturate(1.10) contrast(1.07);
    transform: scale(1.03);
  }
  .heroBg::after{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(920px 520px at 30% 35%, rgba(229,9,20,.14), transparent 60%),
      radial-gradient(900px 520px at 70% 45%, rgba(59,130,246,.09), transparent 60%),
      radial-gradient(900px 520px at 50% 100%, rgba(0,0,0,.55), transparent 60%);
    pointer-events:none;
  }

  .heroInner{
    position:relative;
    width:min(1260px, 92vw);
    margin:0 auto;
    padding: 64px 0 28px 0;
    display:grid;
    grid-template-columns: 1.28fr .72fr;
    gap: 26px;
    align-items:end;
  }

  .heroCard{
    border-radius: 32px;
    background:
      radial-gradient(900px 420px at 12% 0%, rgba(229,9,20,.12), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow);
    backdrop-filter: blur(16px);
    padding: 22px 22px 18px;
    position:relative;
    overflow:hidden;
  }
  .heroCard::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(520px 260px at 18% 18%, rgba(255,255,255,.14), transparent 62%);
    opacity:.55;
    pointer-events:none;
  }
  .heroCard::after{
    content:"";
    position:absolute; inset:0;
    border-radius:32px;
    padding:1px;
    background: linear-gradient(135deg, rgba(255,255,255,.18), rgba(229,9,20,.22), rgba(255,255,255,.10));
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    pointer-events:none;
    opacity:.75;
  }

  .heroTitle{
    margin:0 0 10px 0;
    font-size: clamp(2.55rem, 4.4vw, 4.05rem);
    font-weight: 900;
    letter-spacing: -1.1px;
    line-height: 1.02;
    text-shadow: 0 20px 70px rgba(0,0,0,.62);
  }
  .heroDesc{
    margin:0;
    color: rgba(243,245,255,.88);
    font-size: 1.06rem;
    line-height: 1.7;
    max-width: 74ch;
  }

  .heroMeta{
    margin-top:14px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .tag{
    padding:8px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.11);
    color: rgba(243,245,255,.88);
    font-size:.88rem;
    box-shadow: 0 10px 22px rgba(0,0,0,.16);
  }
  .tag.hot{
    background: rgba(229,9,20,.16);
    border-color: rgba(229,9,20,.38);
    box-shadow: 0 0 0 7px rgba(229,9,20,.12);
  }

  .heroActions{
    margin-top:18px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .cta{
    border:0;
    cursor:pointer;
    border-radius: 999px;
    padding: 12px 18px;
    font-weight: 900;
    display:inline-flex;
    gap:10px;
    align-items:center;
    transition: transform .18s var(--ease), filter .18s var(--ease), background .18s var(--ease), box-shadow .18s var(--ease);
    user-select:none;
    letter-spacing:.2px;
  }
  .cta:active{ transform: scale(.99); }
  .cta.primary{
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color:white;
    box-shadow: 0 20px 46px rgba(229,9,20,.24);
  }
  .cta.primary:hover{ filter: brightness(1.06); transform: translateY(-1px); }
  .cta.ghost{
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    color: var(--text);
  }
  .cta.ghost:hover{
    background: rgba(255,255,255,.10);
    transform: translateY(-1px);
    box-shadow: 0 18px 40px rgba(0,0,0,.22);
  }
  .cta:disabled{ opacity:.45; cursor:not-allowed; transform:none; box-shadow:none; }

  .heroRight{ display:flex; justify-content:flex-end; }
  .heroPoster{
    width: min(360px, 54vw);
    aspect-ratio: 2/3;
    border-radius: 32px;
    border:1px solid rgba(255,255,255,.12);
    overflow:hidden;
    box-shadow: var(--shadow);
    background: rgba(255,255,255,.06);
    position:relative;
    transform: translateY(10px);
  }
  .heroPoster::before{
    content:"";
    position:absolute; inset:-30%;
    background: radial-gradient(520px 320px at 30% 20%, rgba(255,255,255,.18), transparent 60%);
    pointer-events:none;
    filter: blur(1px);
  }
  .heroPoster::after{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,.55) 100%);
    pointer-events:none;
  }
  .heroPoster img{
    width:100%;
    height:100%;
    object-fit:cover;
    filter:saturate(1.10) contrast(1.07);
    transform: scale(1.02);
  }

  /* =========================================================
     CONTENT / ROWS
     ========================================================= */
  .content{
    width:min(1260px, 92vw);
    margin:0 auto;
    padding: 18px 0 72px;
  }
  .sectionHead{
    display:flex;
    justify-content:space-between;
    align-items:end;
    gap:12px;
    margin: 18px 0 10px;
  }
  .sectionTitle{
    margin:0;
    font-size: 1.3rem;
    font-weight: 900;
    letter-spacing: .2px;
    position:relative;
  }
  .sectionTitle::after{
    content:"";
    display:block;
    width: 72px;
    height: 3px;
    border-radius:999px;
    margin-top:8px;
    background: linear-gradient(90deg, rgba(229,9,20,.95), rgba(255,255,255,.10));
    box-shadow: 0 0 0 7px rgba(229,9,20,.08);
    opacity:.9;
  }
  .sectionSub{
    margin-top:3px;
    font-size: .86rem;
    color: var(--muted);
  }

  .ghostBtn{
    border-radius: 999px;
    padding: 10px 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: var(--text);
    font-weight: 900;
    cursor:pointer;
    transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease);
  }
  .ghostBtn:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.18);
    box-shadow: 0 18px 40px rgba(0,0,0,.20);
  }
  .ghostBtn:active{ transform: scale(.99); }

  .rowWrap{ position:relative; }
  .row{
    display:flex;
    gap:12px;
    overflow:auto;
    padding: 10px 2px 16px;
    scroll-snap-type:x mandatory;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,.22) transparent;
  }
  .row::-webkit-scrollbar{height:10px}
  .row::-webkit-scrollbar-thumb{background:rgba(255,255,255,.14);border-radius:999px}
  .row::-webkit-scrollbar-track{background:transparent}

  .rowArrow{
    position:absolute;
    top: 50%;
    transform: translateY(-50%);
    width:46px; height:46px;
    border-radius: 18px;
    display:flex; align-items:center; justify-content:center;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.38);
    backdrop-filter: blur(12px);
    cursor:pointer;
    opacity:0;
    transition: opacity .18s var(--ease), transform .18s var(--ease), background .18s var(--ease), box-shadow .18s var(--ease);
    z-index:3;
    box-shadow: 0 18px 40px rgba(0,0,0,.22);
  }
  .rowWrap:hover .rowArrow{ opacity:1; }
  .rowArrow:hover{
    background: rgba(0,0,0,.56);
    transform: translateY(-50%) scale(1.03);
    box-shadow: 0 0 0 7px rgba(229,9,20,.10), 0 18px 46px rgba(0,0,0,.30);
  }
  .rowArrow:active{ transform: translateY(-50%) scale(.99); }
  .rowArrow.left{ left:-10px; }
  .rowArrow.right{ right:-10px; }

  /* =========================================================
     CARDS
     ========================================================= */
  .card{
    flex:0 0 auto;
    width: var(--cardW);
    border-radius: 24px;
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
    scroll-snap-align:start;
    cursor:pointer;
    position:relative;
    box-shadow: 0 22px 52px rgba(0,0,0,.30);
    transition: transform .20s var(--ease), border-color .20s var(--ease), filter .20s var(--ease), box-shadow .20s var(--ease);
    transform: translateZ(0);
  }
  .card::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(420px 300px at 20% 10%, rgba(255,255,255,.14), transparent 60%);
    opacity:.0;
    transition: opacity .20s var(--ease);
    pointer-events:none;
  }
  .card::after{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,.12) 55%, rgba(0,0,0,.52) 100%);
    opacity:.55;
    pointer-events:none;
  }
  .card:hover{
    transform: translateY(-6px) scale(1.045);
    border-color: rgba(229,9,20,.34);
    filter: brightness(1.06);
    box-shadow: 0 0 0 1px rgba(229,9,20,.18), 0 28px 78px rgba(0,0,0,.45);
  }
  .card:hover::before{ opacity:1; }

  .poster{
    width:100%;
    height: var(--cardH);
    object-fit:cover;
    display:block;
    background: rgba(255,255,255,.06);
    transform: scale(1.02);
    transition: transform .20s var(--ease);
  }
  .card:hover .poster{ transform: scale(1.06); }

  .cardInfo{
    padding: 12px 12px 14px;
    position:relative;
    z-index:2;
  }
  .name{
    font-weight: 900;
    font-size: .98rem;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .meta{
    margin-top:4px;
    color: rgba(243,245,255,.72);
    font-size: .82rem;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .playBadge{
    position:absolute;
    left:12px;
    top:12px;
    height:36px;
    padding:0 12px;
    border-radius: 999px;
    display:flex;
    align-items:center;
    gap:8px;
    background: rgba(0,0,0,.52);
    border: 1px solid rgba(255,255,255,.14);
    backdrop-filter: blur(12px);
    opacity:0;
    transform: translateY(-8px);
    transition: opacity .20s var(--ease), transform .20s var(--ease), box-shadow .20s var(--ease);
    pointer-events:none;
    font-weight:900;
    font-size:.82rem;
    z-index:3;
  }
  .card:hover .playBadge{
    opacity:1;
    transform: translateY(0);
    box-shadow: 0 0 0 7px rgba(229,9,20,.10);
  }
  .playDot{
    width:8px;height:8px;border-radius:999px;
    background: var(--accent);
    box-shadow: 0 0 0 7px rgba(229,9,20,.14);
  }

  /* =========================================================
     SEE ALL PAGE
     ========================================================= */
  #seeAllPage{ display:none; padding-top:10px; }
  .seeAllWrap{
    width:min(1440px, 94vw);
    margin:0 auto;
    padding: 16px 0 74px;
  }
  .seeAllHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin: 10px 0 16px;
  }
  .seeAllLeft{ display:flex; flex-direction:column; }
  .seeAllTitle{
    margin:0;
    font-size: 1.28rem;
    font-weight: 900;
    letter-spacing:.2px;
  }
  .seeAllSub{ margin-top:6px; color: var(--muted); font-size:.90rem; }

  .seeAllGrid{
    display:grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap:18px;
  }
  #seeAllPage .card{ width:100%; border-radius: 28px; }
  #seeAllPage .poster{ height:auto; aspect-ratio: 3 / 5; }

  /* =========================================================
     SERIES DRAWER
     ========================================================= */
  #drawer{
    display:none;
    position:fixed;
    inset:auto 0 0 var(--railW);
    background:
      radial-gradient(900px 260px at 18% 0%, rgba(229,9,20,.12), transparent 60%),
      rgba(10,12,18,.94);
    border-top:1px solid rgba(255,255,255,.10);
    max-height:72vh;
    overflow:auto;
    z-index:250;
    backdrop-filter: blur(18px);
    box-shadow: 0 -22px 80px rgba(0,0,0,.62);
  }
  #drawerHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 12px 14px;
    border-bottom:1px solid rgba(255,255,255,.08);
    background:
      radial-gradient(900px 260px at 20% 0%, rgba(229,9,20,.14), transparent 60%),
      rgba(255,255,255,.03);
    position:sticky;
    top:0;
    z-index:2;
    backdrop-filter: blur(18px);
  }
  #drawer h3{ margin:0; font-weight: 900; }
  #drawerTools{ display:flex; gap:8px; flex-wrap:wrap; }
  .btn{
    border-radius:999px;
    padding:10px 14px;
    font-weight:900;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: var(--text);
    cursor:pointer;
    transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease);
  }
  .btn:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.18);
    box-shadow: 0 18px 44px rgba(0,0,0,.22);
  }
  .btn:active{ transform: scale(.99); }
  .btn.primary{
    border:0;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 18px 40px rgba(229,9,20,.20);
  }
  .btn.primary:hover{ filter: brightness(1.06); }

  #seasons{ padding: 12px 14px; display:grid; gap:10px; }
  details{
    border:1px solid rgba(255,255,255,.10);
    border-radius: 20px;
    overflow:hidden;
    background: rgba(255,255,255,.04);
  }
  summary{
    cursor:pointer;
    padding: 12px 14px;
    font-weight: 900;
    background: rgba(255,255,255,.04);
    user-select:none;
  }
  .episodes{ padding: 10px 12px 12px; display:grid; gap:10px; }
  .ep{
    display:grid;
    grid-template-columns: 1fr auto auto;
    gap:10px;
    align-items:center;
    padding: 10px 10px;
    border-radius: 18px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.22);
  }
  .epName{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    font-weight: 900;
  }

  /* =========================================================
     IN-APP PLAYER ‚Äî fullscreen overlay video
     ========================================================= */
  body.playerOpen{ overflow:hidden; }
  #playerModal{
    position:fixed;
    inset:0;
    z-index:700;
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    background:
      radial-gradient(1200px 700px at 30% 10%, rgba(229,9,20,.18), transparent 60%),
      radial-gradient(900px 600px at 80% 60%, rgba(59,130,246,.12), transparent 60%),
      rgba(0,0,0,.82);
    backdrop-filter: blur(16px);
  }
  #playerModal.show{ display:flex; }
  .playerFrame{
    width:min(1400px, 96vw);
    height:min(780px, 92vh);
    border-radius: 28px;
    border:1px solid rgba(255,255,255,.14);
    background:
      radial-gradient(900px 420px at 12% 0%, rgba(229,9,20,.12), transparent 60%),
      rgba(0,0,0,.62);
    box-shadow: var(--shadow);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    position:relative;
  }
  .playerTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 12px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
  }
  .playerTitle{
    font-weight: 900;
    letter-spacing:.2px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width: 62%;
  }
  .playerBtns{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

  #playerVideo, #dashVideo{
    width:100%;
    height:100%;
    background:#000;
    outline:none;
  }
  #dashVideo{ display:none; }

  .playerHint{
    position:absolute;
    left:14px;
    bottom:14px;
    padding:10px 12px;
    border-radius: 18px;
    background: rgba(0,0,0,.52);
    border:1px solid rgba(255,255,255,.12);
    color: rgba(243,245,255,.92);
    font-size:.84rem;
    backdrop-filter: blur(10px);
    opacity:0;
    transform: translateY(8px);
    transition: opacity .18s var(--ease), transform .18s var(--ease);
    pointer-events:none;
    max-width:min(520px, 92vw);
  }
  .playerHint.show{ opacity:1; transform: translateY(0); }

  @media (max-width: 980px){
    :root{ --railW: 86px; --cardW:160px; --cardH:238px; }
    .seeAllGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .heroPoster{ width:min(320px, 56vw); }
  }
  @media (max-width: 760px){
    .heroInner{ grid-template-columns: 1fr; padding: 46px 0 22px; }
    .heroRight{ justify-content:flex-start; }
    .heroPoster{ width:min(310px, 76vw); }
    #searchWrap{ width: calc(100vw - var(--railW) - 36px); }
    .playerTitle{ max-width: 52%; }
  }
</style>

<!-- Optional playback engines for formats:
     - HLS (m3u8): hls.js for browsers without native HLS
     - DASH (mpd): dash.js
-->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="loginCard">
    <div class="loginTop">
      <div class="brandMark" aria-hidden="true"></div>
      <div class="brandText">STARTV</div>
    </div>
    <p class="loginSub">Press <b>Connect</b> to load your catalog.</p>

    <div class="loginCred">
      <div class="pill">
        <input id="username" placeholder="Optional name (for logs)" value="Guest" />
      </div>
      <div class="pill">
        <input id="password" type="password" placeholder="Optional PIN (local only)" value="" />
      </div>
    </div>

    <button id="connect" class="railBtn primary loginBtn" title="Connect">Connect</button>

    <div id="loginStatus"><span class="statusPill">Not connected</span></div>
    <div class="loginHint">Remote: Arrows to move ‚Ä¢ OK/Enter to select ‚Ä¢ Back to exit dialogs</div>
  </div>
</div>

<header id="hdr">
  <div class="rail">
    <div class="brand">
      <div class="brandMark" aria-hidden="true"></div>
      <div class="brandText">STARTV</div>
    </div>

    <button id="liveBtn" class="railBtn" disabled title="TV">
      <span class="ic" aria-hidden="true">üì∫</span>
      <span class="lbl">TV</span>
    </button>

    <button id="moviesBtn" class="railBtn" disabled title="Movies">
      <span class="ic" aria-hidden="true">üé¨</span>
      <span class="lbl">Movies</span>
    </button>

    <button id="seriesBtn" class="railBtn" disabled title="Series">
      <span class="ic" aria-hidden="true">üìö</span>
      <span class="lbl">Series</span>
    </button>

    <div class="spacer"></div>

    <button id="toggleSearch" class="railBtn" disabled title="Search">
      <span class="ic" aria-hidden="true">üîé</span>
      <span class="lbl">Search</span>
    </button>

    <button id="logout" class="railBtn" title="Logout">
      <span class="ic" aria-hidden="true">‚Ü©</span>
      <span class="lbl">Logout</span>
    </button>

    <div id="status"><span class="statusPill">Not connected</span></div>

    <!-- Search overlay -->
    <div id="searchWrap">
      <div class="searchShell">
        <div class="searchBar">
          <div class="searchIcon" aria-hidden="true">üîé</div>
          <input id="search" placeholder="Type 3+ letters to search..." />
          <span class="kbd">Esc</span>
        </div>
        <div id="searchResults"></div>
      </div>
    </div>

  </div>
</header>

<!-- BROWSE PAGE -->
<div id="browsePage">
  <section class="hero">
    <div class="heroBg" id="heroBg"></div>

    <div class="heroInner">
      <div class="heroCard">
        <h1 class="heroTitle" id="heroTitle">Welcome</h1>
        <p class="heroDesc" id="heroDesc">
          Connect, then choose TV / Movies / Series. Your catalog loads instantly.
        </p>

        <div class="heroMeta" id="heroMeta">
          <span class="tag hot">STARTV</span>
          <span class="tag">Remote Ready</span>
          <span class="tag">Logs to Sheet</span>
        </div>

        <div class="heroActions" id="heroActions">
          <button class="cta primary" id="heroPlay" disabled>Play / Open</button>
          <button class="cta ghost" id="heroFav" disabled>‚òÖ Favorite</button>
        </div>
      </div>

      <div class="heroRight">
        <div class="heroPoster">
          <img id="heroPoster" alt="Poster"
               src="https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?auto=format&fit=crop&w=800&q=60" />
        </div>
      </div>
    </div>
  </section>

  <section class="content" id="content">
    <div id="rows"></div>
  </section>
</div>

<!-- SEE ALL PAGE -->
<div id="seeAllPage">
  <div class="seeAllWrap">
    <div class="seeAllHead">
      <div class="seeAllLeft">
        <h2 class="seeAllTitle" id="seeAllTitle">Category</h2>
        <div class="seeAllSub" id="seeAllSub">Showing all items</div>
      </div>
      <button id="seeAllBack" class="ghostBtn">Back</button>
    </div>
    <div class="seeAllGrid" id="seeAllGrid"></div>
  </div>
</div>

<!-- Series drawer -->
<div id="drawer">
  <div id="drawerHead">
    <h3 id="seriesTitle">Series</h3>
    <div id="drawerTools">
      <button id="closeDrawer" class="btn">Close</button>
    </div>
  </div>
  <div id="seasons"></div>
</div>

<!-- IN-APP PLAYER -->
<div id="playerModal" aria-hidden="true">
  <div class="playerFrame">
    <div class="playerTop">
      <div class="playerTitle" id="playerTitle">Playing‚Ä¶</div>
      <div class="playerBtns">
        <button id="playerPlayPause" class="btn" title="Play/Pause">Play/Pause</button>
        <button id="playerExternal" class="btn primary" title="Open external">Open External</button>
        <button id="playerClose" class="btn" title="Close">Close</button>
      </div>
    </div>

    <!-- HTML5 video -->
    <video id="playerVideo" controls playsinline></video>

    <!-- DASH fallback player element -->
    <video id="dashVideo" controls playsinline></video>

    <div class="playerHint" id="playerHint">Tip: ‚Üê/‚Üí seek ‚Ä¢ Enter OK play/pause ‚Ä¢ Back closes</div>
  </div>
</div>

<script>
/* =========================================================
   YOU MUST SET THESE TWO:
   ========================================================= */
const CATALOG_URL = "catalog.json"; // <-- Your authorized catalog file (same folder is easiest)
const SHEET_LOGGER_URL = "PASTE_YOUR_GOOGLE_APPS_SCRIPT_WEBAPP_URL_HERE"; // <-- logs clicks/plays

/* ---------------- Helpers ---------------- */
const $ = id => document.getElementById(id);
const placeholderImg = 'https://via.placeholder.com/300x450?text=No+Image';

function escapeHtml(s){
  return String(s||'')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

function setStatus(msg, kind){
  const cls = kind === 'ok' ? 'ok' : kind === 'err' ? 'err' : 'warn';
  const html = `<span class="statusPill ${cls}">${escapeHtml(msg)}</span>`;
  if ($('status')) $('status').innerHTML = html;
  if ($('loginStatus')) $('loginStatus').innerHTML = html;
}

/* =========================================================
   SHEET LOGGING (click/play links)
   - fire-and-forget
   - uses sendBeacon when possible
   - else fetch(mode:no-cors)
   ========================================================= */
function logToSheet(payload){
  try{
    if (!SHEET_LOGGER_URL || SHEET_LOGGER_URL.includes("PASTE_")) return;

    const body = JSON.stringify(payload);

    // Prefer sendBeacon (best for TVs / background)
    if (navigator.sendBeacon){
      const blob = new Blob([body], { type: "text/plain;charset=utf-8" });
      navigator.sendBeacon(SHEET_LOGGER_URL, blob);
      return;
    }

    // Fallback: fetch without CORS (Apps Script will still receive it)
    fetch(SHEET_LOGGER_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body
    }).catch(()=>{});
  }catch(e){}
}

function buildLog(eventType, extra){
  return {
    event: eventType,                 // "select" | "play"
    when: new Date().toISOString(),
    userLabel: (S.userLabel||"").trim(),
    kind: S.kind || "",
    title: extra?.title || "",
    url: extra?.url || "",
    category: extra?.category || "",
    id: extra?.id || "",
    ua: navigator.userAgent || ""
  };
}

/* =========================================================
   STATE
   ========================================================= */
const S = {
  loggedIn: false,
  userLabel: "Guest",

  kind: "movies", // live | movies | series
  catalog: null,

  // current selection
  hero: { kind:"", item:null, catName:"" },

  // search index
  index: [],

  // see-all
  seeAll: { open:false, catName:"" },

  // player
  player: { open:false, url:"", title:"", poster:"" },

  // series
  currentSeries: null,
};

/* ===== Header behavior ===== */
const hdr = $('hdr');
window.addEventListener('scroll', ()=>{
  if (window.scrollY > 20) hdr.classList.add('solid');
  else hdr.classList.remove('solid');
});

/* =========================================================
   TV FOCUS / REMOTE NAV
   ========================================================= */
function clearTvFocus(){
  const cur = document.querySelector('.tv-focus');
  if (cur) cur.classList.remove('tv-focus');
}
function tvFocus(el){
  if (!el) return;
  clearTvFocus();
  el.classList.add('tv-focus');
  try{ el.focus({preventScroll:true}); }catch{ try{ el.focus(); }catch{} }
  try{ el.scrollIntoView({block:'nearest', inline:'nearest'}); }catch{}
}
function isVisibleEl(el){
  if (!el) return false;
  if (el.disabled) return false;
  const style = window.getComputedStyle(el);
  if (style.visibility === 'hidden' || style.display === 'none') return false;
  const r = el.getClientRects();
  return r && r.length > 0;
}
function activeScope(){
  if (!S.loggedIn) return $('loginPage');
  if (playerIsOpen()) return $('playerModal');
  if ($('searchWrap').classList.contains('open')) return $('searchWrap');
  if ($('drawer').style.display !== 'none') return $('drawer');
  if ($('seeAllPage').style.display !== 'none') return $('seeAllPage');
  return $('browsePage');
}
function collectFocusable(){
  const sel = [
    'button:not([disabled])',
    'input:not([disabled])',
    '[tabindex="0"]',
    'summary',
    'video'
  ].join(',');

  const scope = activeScope();
  const roots = [hdr, scope];

  const all = [];
  roots.forEach(root=>{
    if (!root) return;
    root.querySelectorAll(sel).forEach(el=> all.push(el));
  });

  const vw = window.innerWidth, vh = window.innerHeight;
  const margin = 260;

  return all.filter(el=>{
    if (!isVisibleEl(el)) return false;
    const rect = el.getBoundingClientRect();
    if (rect.bottom < -margin) return false;
    if (rect.top > vh + margin) return false;
    if (rect.right < -margin) return false;
    if (rect.left > vw + margin) return false;
    return true;
  });
}
function centerOf(el){
  const r = el.getBoundingClientRect();
  return { x: r.left + r.width/2, y: r.top + r.height/2 };
}
function nextByDirection(dir){
  const cur = (document.activeElement && isVisibleEl(document.activeElement))
    ? document.activeElement
    : document.querySelector('.tv-focus');

  const items = collectFocusable();
  if (!items.length) return null;

  if (!cur || !items.includes(cur)) return items[0];

  const c = centerOf(cur);
  let best = null;
  let bestScore = Infinity;

  for (const el of items){
    if (el === cur) continue;
    const p = centerOf(el);
    const dx = p.x - c.x;
    const dy = p.y - c.y;

    if (dir === 'ArrowLeft'  && dx >= -4) continue;
    if (dir === 'ArrowRight' && dx <=  4) continue;
    if (dir === 'ArrowUp'    && dy >= -4) continue;
    if (dir === 'ArrowDown'  && dy <=  4) continue;

    const primary = (dir === 'ArrowLeft' || dir === 'ArrowRight') ? Math.abs(dx) : Math.abs(dy);
    const secondary = (dir === 'ArrowLeft' || dir === 'ArrowRight') ? Math.abs(dy) : Math.abs(dx);
    const dist = Math.hypot(dx, dy);

    const score = primary*1.0 + secondary*0.28 + dist*0.02;
    if (score < bestScore){ bestScore = score; best = el; }
  }
  return best;
}

/* =========================================================
   SEARCH
   ========================================================= */
function openSearch(){
  if (!S.loggedIn) return;
  $('searchWrap').classList.add('open');
  setTimeout(()=> $('search').focus(), 0);
}
function closeSearchHard(){
  $('search').value = '';
  $('searchWrap').classList.remove('open');
  $('searchResults').classList.remove('show');
  $('searchResults').innerHTML = '';
}
function closeSearchIfEmpty(){
  if (($('search').value||'').trim() === ''){
    $('searchWrap').classList.remove('open');
    $('searchResults').classList.remove('show');
    $('searchResults').innerHTML = '';
  }
}
$('toggleSearch').onclick = ()=>{
  if (!S.loggedIn) return;
  const open = $('searchWrap').classList.contains('open');
  if (open) closeSearchIfEmpty();
  else openSearch();
};
document.addEventListener('click', (e)=>{
  if (!S.loggedIn) return;
  if (playerIsOpen()) return;
  const inside = $('searchWrap').contains(e.target) || $('toggleSearch').contains(e.target);
  if (!inside) closeSearchIfEmpty();
});
$('search').addEventListener('blur', ()=> setTimeout(closeSearchIfEmpty, 150));

function renderSearchHits(hits){
  if (!hits.length){
    $('searchResults').classList.add('show');
    $('searchResults').innerHTML = `
      <div class="resItem" tabindex="0">
        <div class="resText">
          <div class="resName">No results found</div>
          <div class="resMeta">Try another keyword, or switch TV/Movies/Series.</div>
        </div>
      </div>`;
    return;
  }

  $('searchResults').classList.add('show');
  $('searchResults').innerHTML = '';
  hits.forEach(h=>{
    const div = document.createElement('div');
    div.className = 'resItem';
    div.tabIndex = 0;
    div.innerHTML = `
      <img class="resThumb" src="${h.poster||placeholderImg}" onerror="this.src='${placeholderImg}'" />
      <div class="resText">
        <div class="resName">${escapeHtml(h.title)}</div>
        <div class="resMeta">${escapeHtml(h.meta||'')}</div>
      </div>
    `;

    div.addEventListener('focus', ()=>{ clearTvFocus(); div.classList.add('tv-focus'); });
    div.addEventListener('blur', ()=> div.classList.remove('tv-focus'));

    div.onclick = ()=>{
      closeSearchHard();
      if (h.kind === "series"){
        openSeries(h.item, h.category);
      } else {
        setHero(h.kind, h.item, h.category);
        setTimeout(()=> tvFocus($('heroPlay')), 60);
      }
    };

    div.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || (e.keyCode||e.which) === 13){
        e.preventDefault();
        div.click();
      }
    });

    $('searchResults').appendChild(div);
  });
}

$('search').addEventListener('input', ()=>{
  const q = ($('search').value||'').trim().toLowerCase();
  if (q.length < 3){
    $('searchResults').classList.remove('show');
    $('searchResults').innerHTML = '';
    return;
  }
  const hits = S.index
    .filter(x => x.kind === S.kind && x.titleLc.includes(q))
    .slice(0, 12);
  renderSearchHits(hits);
});

/* =========================================================
   PLAYER (mp4 / m3u8 / mpd)
   ========================================================= */
let hintTimer = null;
let hls = null;
let dashPlayer = null;

function showPlayerHint(msg){
  const el = $('playerHint');
  if (!el) return;
  el.textContent = msg || 'Tip: ‚Üê/‚Üí seek ‚Ä¢ Enter OK play/pause ‚Ä¢ Back closes';
  el.classList.add('show');
  clearTimeout(hintTimer);
  hintTimer = setTimeout(()=> el.classList.remove('show'), 1800);
}
function playerIsOpen(){ return $('playerModal').classList.contains('show'); }

function cleanupEngines(){
  try{
    if (hls){ hls.destroy(); hls = null; }
  }catch{}
  try{
    if (dashPlayer){ dashPlayer.reset(); dashPlayer = null; }
  }catch{}
  $('playerVideo').style.display = 'block';
  $('dashVideo').style.display = 'none';
}

function openPlayer(url, title, poster, logMeta){
  if (!url) return;

  // Log PLAY to sheet (fire-and-forget)
  logToSheet(buildLog("play", {
    title: title || "Playing",
    url,
    category: logMeta?.category || "",
    id: logMeta?.id || ""
  }));

  // Close overlays
  closeSearchHard();
  closeDrawer();

  S.player.open = true;
  S.player.url = url;
  S.player.title = title || 'Playing‚Ä¶';
  S.player.poster = poster || '';

  $('playerTitle').textContent = S.player.title;
  $('playerModal').classList.add('show');
  document.body.classList.add('playerOpen');

  cleanupEngines();

  const ext = (url.split('?')[0].split('.').pop() || '').toLowerCase();

  // Try to play depending on format
  const v = $('playerVideo');
  const dv = $('dashVideo');

  // reset elements
  try{ v.pause(); }catch{}
  try{ dv.pause(); }catch{}
  v.removeAttribute('src'); v.load();
  dv.removeAttribute('src'); dv.load();

  if (poster) v.setAttribute('poster', poster);
  else v.removeAttribute('poster');

  showPlayerHint('Loading‚Ä¶');

  // DASH (.mpd)
  if (ext === 'mpd'){
    $('playerVideo').style.display = 'none';
    $('dashVideo').style.display = 'block';
    try{
      dashPlayer = dashjs.MediaPlayer().create();
      dashPlayer.initialize(dv, url, true);
      showPlayerHint('Playing DASH ‚Ä¢ ‚Üê/‚Üí seek ‚Ä¢ Back closes');
      setTimeout(()=> tvFocus($('playerClose')), 80);
      return;
    }catch{
      showPlayerHint('DASH error ‚Ä¢ Try Open External');
    }
  }

  // HLS (.m3u8)
  if (ext === 'm3u8'){
    // Native HLS first (Safari / some TVs)
    if (v.canPlayType('application/vnd.apple.mpegurl')){
      v.src = url;
      v.play().then(()=>{
        showPlayerHint('Playing HLS ‚Ä¢ ‚Üê/‚Üí seek ‚Ä¢ Back closes');
      }).catch(()=>{
        showPlayerHint('Press OK/Enter to Play ‚Ä¢ Back closes');
      });
      setTimeout(()=> tvFocus($('playerClose')), 80);
      return;
    }

    // hls.js fallback
    if (window.Hls && Hls.isSupported()){
      try{
        hls = new Hls({ enableWorker: true, lowLatencyMode: true });
        hls.loadSource(url);
        hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=>{
          v.play().then(()=>{
            showPlayerHint('Playing HLS ‚Ä¢ ‚Üê/‚Üí seek ‚Ä¢ Back closes');
          }).catch(()=>{
            showPlayerHint('Press OK/Enter to Play ‚Ä¢ Back closes');
          });
        });
        hls.on(Hls.Events.ERROR, ()=>{
          showPlayerHint('HLS error ‚Ä¢ Try Open External');
        });
        setTimeout(()=> tvFocus($('playerClose')), 80);
        return;
      }catch{
        showPlayerHint('HLS error ‚Ä¢ Try Open External');
      }
    }
  }

  // Default: direct src (mp4/webm/others if supported)
  v.src = url;
  v.play().then(()=>{
    showPlayerHint('Playing ‚Ä¢ ‚Üê/‚Üí seek ‚Ä¢ Back closes');
  }).catch(()=>{
    showPlayerHint('Press OK/Enter to Play ‚Ä¢ Back closes');
  });

  setTimeout(()=> tvFocus($('playerClose')), 80);
}

function closePlayer(){
  cleanupEngines();
  const v = $('playerVideo');
  const dv = $('dashVideo');
  try{ v.pause(); }catch{}
  try{ dv.pause(); }catch{}
  try{ v.removeAttribute('src'); v.load(); }catch{}
  try{ dv.removeAttribute('src'); dv.load(); }catch{}
  $('playerModal').classList.remove('show');
  document.body.classList.remove('playerOpen');
  S.player.open = false;

  // Restore focus
  if (S.loggedIn) setTimeout(()=> tvFocus($('heroPlay').disabled ? $('moviesBtn') : $('heroPlay')), 60);
  else setTimeout(()=> tvFocus($('username')), 60);
}

$('playerClose').onclick = closePlayer;
$('playerExternal').onclick = ()=>{ if (S.player.url) window.open(S.player.url,'_blank','noopener'); };
$('playerPlayPause').onclick = ()=>{
  // if dash is active
  const isDash = $('dashVideo').style.display === 'block';
  const v = isDash ? $('dashVideo') : $('playerVideo');
  if (!v) return;
  if (v.paused){ v.play().catch(()=>{}); showPlayerHint('Play'); }
  else { v.pause(); showPlayerHint('Pause'); }
};

$('playerVideo').addEventListener('error', ()=> showPlayerHint('Cannot play this format here ‚Ä¢ Try Open External'));
$('dashVideo').addEventListener('error', ()=> showPlayerHint('Cannot play this format here ‚Ä¢ Try Open External'));

/* =========================================================
   BACK/OK/ARROWS handling
   ========================================================= */
function handleBack(){
  if (!S.loggedIn) return false;
  if (playerIsOpen()){ closePlayer(); return true; }
  if ($('searchWrap').classList.contains('open')){ closeSearchHard(); tvFocus($('toggleSearch')); return true; }
  if ($('drawer').style.display !== 'none'){ closeDrawer(); tvFocus($('heroPlay').disabled ? $('moviesBtn') : $('heroPlay')); return true; }
  if (S.seeAll.open){
    if (history.length > 1) history.back();
    else showBrowsePage(true);
    return true;
  }
  return false;
}
function handleOk(){
  if (playerIsOpen()){ $('playerPlayPause').click(); return; }
  const el = document.activeElement;
  if (!S.loggedIn && (el === $('username') || el === $('password') || el === $('connect'))){
    doConnect();
    return;
  }
  if (el && typeof el.click === 'function') el.click();
}

document.addEventListener('keydown', (e)=>{
  const key = e.key;
  const code = e.keyCode || e.which;

  const isBack =
    key === 'Escape' || key === 'Backspace' || key === 'BrowserBack' || key === 'GoBack' || key === 'Return' ||
    code === 10009 || code === 461 || code === 27 || code === 8;

  if (isBack){
    const handled = handleBack();
    if (handled){ e.preventDefault(); e.stopPropagation(); }
    return;
  }

  if (key === 'Enter' || code === 13){
    e.preventDefault();
    e.stopPropagation();
    handleOk();
    return;
  }

  const isArrow =
    key === 'ArrowLeft' || key === 'ArrowRight' || key === 'ArrowUp' || key === 'ArrowDown' ||
    code === 37 || code === 38 || code === 39 || code === 40;

  if (isArrow){
    const dir = key.startsWith('Arrow') ? key : (code===37?'ArrowLeft':code===38?'ArrowUp':code===39?'ArrowRight':'ArrowDown');

    // If search input is focused and down pressed -> go to first result
    if (S.loggedIn && $('searchWrap').classList.contains('open') && document.activeElement === $('search') && dir === 'ArrowDown'){
      const firstRes = $('searchResults').querySelector('.resItem[tabindex="0"]');
      if (firstRes){ e.preventDefault(); tvFocus(firstRes); return; }
    }

    e.preventDefault();
    e.stopPropagation();

    const next = nextByDirection(dir);
    if (next) tvFocus(next);
  }
});

/* =========================================================
   PAGE switching (browse <-> see all)
   ========================================================= */
function showBrowsePage(push=false){
  S.seeAll.open = false;
  $('seeAllPage').style.display = 'none';
  $('browsePage').style.display = 'block';
  if (push) history.pushState({page:'browse'}, '', '#browse');
}
function showSeeAllPage(catName, push=false){
  S.seeAll.open = true;
  S.seeAll.catName = String(catName || '');
  $('browsePage').style.display = 'none';
  $('seeAllPage').style.display = 'block';
  $('seeAllTitle').textContent = S.seeAll.catName || 'Category';
  $('seeAllSub').textContent = `Showing all items ‚Ä¢ 4 per row`;
  if (push) history.pushState({page:'seeall', kind:S.kind, catName:S.seeAll.catName}, '', `#cat=${encodeURIComponent(S.seeAll.catName)}`);
  window.scrollTo({top:0, behavior:'instant'});
}
window.addEventListener('popstate', (e)=>{
  const st = e.state || {};
  if (st.page === 'seeall' && st.catName){
    openCategoryPage(st.catName, false).catch(()=>{});
  } else showBrowsePage(false);
});
$('seeAllBack').onclick = ()=>{
  if (history.length > 1) history.back();
  else showBrowsePage(true);
};

/* =========================================================
   CATALOG LOADING (authorized links only)
   ========================================================= */
async function loadCatalog(){
  const r = await fetch(CATALOG_URL, { cache: "no-store" });
  if (!r.ok) throw new Error("Catalog HTTP " + r.status);
  const data = await r.json();
  return data;
}

function normalizeKind(kind){
  const k = String(kind||'').toLowerCase();
  if (k === 'tv' || k === 'live') return 'live';
  if (k === 'movies' || k === 'movie' || k === 'vod') return 'movies';
  if (k === 'series' || k === 'shows') return 'series';
  return 'movies';
}

function buildIndex(){
  S.index = [];
  const kinds = ['live','movies','series'];
  kinds.forEach(k=>{
    const cats = (S.catalog?.[k]?.categories || []);
    cats.forEach(cat=>{
      (cat.items || []).forEach(item=>{
        const title = item.title || item.name || 'Item';
        S.index.push({
          kind: k,
          category: cat.name || '',
          title,
          titleLc: title.toLowerCase(),
          poster: item.poster || item.cover || item.image || '',
          meta: item.meta || (item.url ? (item.url.split('?')[0].split('.').pop()||'').toUpperCase() : ''),
          item
        });
      });
    });
  });
}

function setActiveNav(kind){
  $('liveBtn').classList.remove('navActive');
  $('moviesBtn').classList.remove('navActive');
  $('seriesBtn').classList.remove('navActive');
  if (kind === 'live') $('liveBtn').classList.add('navActive');
  if (kind === 'movies') $('moviesBtn').classList.add('navActive');
  if (kind === 'series') $('seriesBtn').classList.add('navActive');
}

function setHero(kind, item, catName){
  S.hero = { kind, item, catName };

  const title = item?.title || item?.name || (kind==='live'?'Live TV':'Title');
  $('heroTitle').textContent = title;

  const desc =
    kind==='live' ? 'Tap Play to open the stream.' :
    kind==='movies' ? 'Tap Play to open the movie.' :
    'Tap Play to browse episodes.';
  $('heroDesc').textContent = desc;

  const poster = item?.poster || item?.cover || item?.image || $('heroPoster').src;
  $('heroPoster').src = poster || placeholderImg;
  $('heroPoster').onerror = ()=> $('heroPoster').src = placeholderImg;

  $('heroBg').style.backgroundImage =
    `linear-gradient(90deg, rgba(4,5,10,.98) 0%, rgba(4,5,10,.66) 46%, rgba(4,5,10,.20) 76%, rgba(4,5,10,.98) 100%),
     linear-gradient(0deg, rgba(4,5,10,.98) 0%, rgba(4,5,10,.58) 28%, rgba(4,5,10,.14) 60%, rgba(4,5,10,.98) 100%),
     url('${poster || placeholderImg}')`;

  $('heroMeta').innerHTML = `
    <span class="tag hot">${kind==='live'?'TV':kind==='movies'?'Movies':'Series'}</span>
    <span class="tag">${escapeHtml(catName || '‚Äî')}</span>
  `;

  $('heroPlay').disabled = false;
  $('heroFav').disabled = true;
}

function makeCard(kind, item, catName){
  const div = document.createElement('div');
  div.className = 'card';
  div.tabIndex = 0;
  div.setAttribute('role','button');

  div.addEventListener('focus', ()=>{ clearTvFocus(); div.classList.add('tv-focus'); });
  div.addEventListener('blur', ()=> div.classList.remove('tv-focus'));
  div.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' || (e.keyCode||e.which) === 13){
      e.preventDefault();
      div.click();
    }
  });

  const title = item?.title || item?.name || 'Item';
  const poster = item?.poster || item?.cover || item?.image || placeholderImg;
  const url = item?.url || '';
  const meta = item?.meta || (url ? (url.split('?')[0].split('.').pop()||'').toUpperCase() : '');

  div.innerHTML = `
    <div class="playBadge"><span class="playDot"></span>Play</div>
    <img class="poster" src="${poster}" onerror="this.src='${placeholderImg}'" />
    <div class="cardInfo">
      <div class="name">${escapeHtml(title)}</div>
      <div class="meta">${escapeHtml(meta)}</div>
    </div>
  `;

  // click behavior + LOG SELECT
  div.onclick = ()=>{
    // LOG selection (movie/series/tv click)
    logToSheet(buildLog("select", {
      title,
      url: (kind === "series" ? "" : url),
      category: catName || "",
      id: item?.id || item?.series_id || ""
    }));

    setHero(kind, item, catName);

    if (kind === "series"){
      openSeries(item, catName);
      return;
    }

    // play immediately
    openPlayer(url, title, poster, {
      category: catName || "",
      id: item?.id || ""
    });
  };

  div.addEventListener('mouseenter', ()=> setHero(kind, item, catName));
  return div;
}

function renderRows(){
  const rows = $('rows');
  rows.innerHTML = '';

  const section = (kindKey, label)=>{
    const cats = (S.catalog?.[kindKey]?.categories || []);
    if (!cats.length){
      rows.innerHTML = `<p style="color:var(--muted)">No categories.</p>`;
      return;
    }

    cats.forEach(cat=>{
      const catName = cat.name || 'Category';
      const sec = document.createElement('section');
      sec.innerHTML = `
        <div class="sectionHead">
          <div>
            <h2 class="sectionTitle">${escapeHtml(catName)}</h2>
            <div class="sectionSub">${escapeHtml(label)}</div>
          </div>
          <button class="ghostBtn">See all</button>
        </div>
        <div class="rowWrap">
          <div class="rowArrow left" title="Scroll left" tabindex="0" role="button">‚óÄ</div>
          <div class="row"></div>
          <div class="rowArrow right" title="Scroll right" tabindex="0" role="button">‚ñ∂</div>
        </div>
      `;

      const rowEl = sec.querySelector('.row');
      const leftBtn = sec.querySelector('.rowArrow.left');
      const rightBtn = sec.querySelector('.rowArrow.right');
      const seeAllBtn = sec.querySelector('.ghostBtn');

      (cat.items || []).slice(0, 16).forEach(item=>{
        rowEl.appendChild(makeCard(kindKey, item, catName));
      });

      leftBtn.onclick = ()=> rowEl.scrollBy({left: -Math.min(rowEl.clientWidth*0.9, 900), behavior:'smooth'});
      rightBtn.onclick = ()=> rowEl.scrollBy({left:  Math.min(rowEl.clientWidth*0.9, 900), behavior:'smooth'});

      [leftBtn, rightBtn].forEach(btn=>{
        btn.addEventListener('focus', ()=>{ clearTvFocus(); btn.classList.add('tv-focus'); });
        btn.addEventListener('blur', ()=> btn.classList.remove('tv-focus'));
        btn.addEventListener('keydown', (e)=>{
          if (e.key === 'Enter' || (e.keyCode||e.which) === 13){
            e.preventDefault(); btn.click();
          }
        });
      });

      seeAllBtn.onclick = ()=> openCategoryPage(catName, true);

      rows.appendChild(sec);
    });
  };

  if (S.kind === 'live') section('live', 'Channels');
  if (S.kind === 'movies') section('movies', 'Titles');
  if (S.kind === 'series') section('series', 'Shows');
}

async function openCategoryPage(catName, pushState=true){
  closeSearchHard();
  closeDrawer();
  showSeeAllPage(catName, pushState);

  const grid = $('seeAllGrid');
  grid.innerHTML = '';

  const cats = (S.catalog?.[S.kind]?.categories || []);
  const cat = cats.find(c => String(c.name||'') === String(catName||''));
  if (!cat){
    grid.innerHTML = `<div style="grid-column:1/-1;color:var(--muted);padding:8px 0;">Category not found.</div>`;
    return;
  }

  (cat.items || []).forEach(item=>{
    grid.appendChild(makeCard(S.kind, item, catName));
  });

  setTimeout(()=>{
    const first = grid.querySelector('.card[tabindex="0"]');
    if (first) tvFocus(first);
  }, 60);
}

/* =========================================================
   SERIES DRAWER (episodes from catalog.json)
   series item example:
   {
     "title":"My Show",
     "poster":"...",
     "seasons":[
       {"season":1,"episodes":[{"title":"Ep 1","url":"...m3u8"}]}
     ]
   }
   ========================================================= */
function openSeries(seriesItem, catName){
  $('seriesTitle').textContent = seriesItem?.title || seriesItem?.name || 'Series';
  $('seasons').innerHTML = '';
  $('drawer').style.display = 'block';

  S.currentSeries = seriesItem;

  const seasons = seriesItem?.seasons || [];
  if (!seasons.length){
    $('seasons').innerHTML = `<div style="color:var(--muted);padding:8px">No episodes found in catalog.</div>`;
    return;
  }

  seasons.forEach(s=>{
    const det = document.createElement('details');
    const sum = document.createElement('summary');
    sum.textContent = `Season ${s.season || ''} ‚Ä¢ ${(s.episodes||[]).length} episode(s)`;
    sum.tabIndex = 0;

    sum.addEventListener('focus', ()=>{ clearTvFocus(); sum.classList.add('tv-focus'); });
    sum.addEventListener('blur', ()=> sum.classList.remove('tv-focus'));
    sum.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || (e.keyCode||e.which) === 13){
        e.preventDefault();
        det.open = !det.open;
      }
    });

    const wrap = document.createElement('div');
    wrap.className = 'episodes';

    (s.episodes||[]).forEach(ep=>{
      const row = document.createElement('div');
      row.className = 'ep';

      const title = document.createElement('div');
      title.className = 'epName';
      title.textContent = ep.title || 'Episode';

      const playBtn = document.createElement('button');
      playBtn.className = 'btn primary';
      playBtn.textContent = 'Play';
      playBtn.onclick = ()=>{
        // LOG select + play
        logToSheet(buildLog("select", {
          title: `${seriesItem.title || seriesItem.name || 'Series'} ‚Ä¢ ${ep.title || 'Episode'}`,
          url: ep.url || '',
          category: catName || '',
          id: ep.id || ''
        }));
        openPlayer(ep.url || '', `${seriesItem.title || seriesItem.name || 'Series'} ‚Ä¢ ${ep.title || 'Episode'}`, seriesItem.poster || seriesItem.cover || '', {
          category: catName || '',
          id: ep.id || ''
        });
      };

      const openBtn = document.createElement('button');
      openBtn.className = 'btn';
      openBtn.textContent = 'Open';
      openBtn.onclick = ()=>{
        // LOG open
        logToSheet(buildLog("select", {
          title: `${seriesItem.title || seriesItem.name || 'Series'} ‚Ä¢ ${ep.title || 'Episode'}`,
          url: ep.url || '',
          category: catName || '',
          id: ep.id || ''
        }));
        window.open(ep.url || '', '_blank', 'noopener');
      };

      row.appendChild(title);
      row.appendChild(playBtn);
      row.appendChild(openBtn);
      wrap.appendChild(row);
    });

    det.appendChild(sum);
    det.appendChild(wrap);
    $('seasons').appendChild(det);
  });

  const first = $('seasons').querySelector('details');
  if (first) first.open = true;

  setTimeout(()=>{
    const firstSum = $('seasons').querySelector('summary');
    if (firstSum) tvFocus(firstSum);
  }, 80);
}

function closeDrawer(){
  $('drawer').style.display='none';
  S.currentSeries=null;
}
$('closeDrawer').onclick = closeDrawer;

/* =========================================================
   BUTTONS / NAV
   ========================================================= */
$('liveBtn').onclick  = ()=> loadKind('live');
$('moviesBtn').onclick= ()=> loadKind('movies');
$('seriesBtn').onclick= ()=> loadKind('series');

function loadKind(kind){
  S.kind = normalizeKind(kind);
  setActiveNav(S.kind);
  closeDrawer();
  closeSearchHard();
  showBrowsePage(true);

  $('rows').innerHTML = '';
  $('heroTitle').textContent = S.kind==='live'?'TV':'Browse';
  $('heroDesc').textContent = 'Scroll down ‚Äî each category is a horizontal slider row.';
  $('heroPlay').disabled = true;
  $('heroFav').disabled = true;

  renderRows();

  setTimeout(()=>{
    const firstCard = document.querySelector('#rows .card[tabindex="0"]');
    if (firstCard) tvFocus(firstCard);
  }, 250);
}

$('heroPlay').onclick = ()=>{
  const { kind, item, catName } = S.hero;
  if (!item) return;

  const title = item.title || item.name || 'Item';
  const poster = item.poster || item.cover || item.image || '';
  const url = item.url || '';

  // LOG select (hero play)
  logToSheet(buildLog("select", {
    title,
    url: (kind === "series" ? "" : url),
    category: catName || "",
    id: item?.id || item?.series_id || ""
  }));

  if (kind === 'series'){ openSeries(item, catName); return; }
  openPlayer(url, title, poster, { category: catName || "", id: item?.id || "" });
};

$('logout').onclick = ()=> location.reload();

/* =========================================================
   CONNECT / INIT
   ========================================================= */
async function doConnect(){
  setStatus('Connecting‚Ä¶','warn');
  try{
    S.userLabel = ($('username').value || 'Guest').trim() || 'Guest';

    S.catalog = await loadCatalog();
    buildIndex();

    S.loggedIn = true;
    document.body.classList.add('loggedIn');

    $('liveBtn').disabled = false;
    $('moviesBtn').disabled = false;
    $('seriesBtn').disabled = false;
    $('toggleSearch').disabled = false;

    setStatus('Connected','ok');

    $('heroTitle').textContent = 'Connected';
    $('heroDesc').textContent = 'Use remote arrows + OK. Choose TV / Movies / Series to start.';
    $('heroPlay').disabled = true;
    $('heroFav').disabled = true;

    loadKind('movies');
    setTimeout(()=> tvFocus($('moviesBtn')), 60);

  }catch(e){
    console.error(e);
    setStatus('Cannot load catalog.json','err');
    setTimeout(()=> tvFocus($('connect')), 60);
  }
}

$('connect').onclick = doConnect;

/* Default route */
history.replaceState({page:'browse'}, '', '#browse');

/* initial focus */
setTimeout(()=> tvFocus($('connect')), 120);
</script>

</body>
</html>
